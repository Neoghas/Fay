<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Faylotto Spin Battle</title>

<!-- Font: Ubuntu -->
<link href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;700&display=swap" rel="stylesheet" />

<!-- GSAP & Ethers -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>

<style>
  body {
    margin: 0;
    height: 100vh;
    background: radial-gradient(circle at center, #0b0b12 0%, #000 100%);
    font-family: "Ubuntu", sans-serif;
    color: #fff;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    overflow: hidden;
  }

  /* === Wallet Button Top Right === */
  .wallet-btn {
    position: fixed;
    top: 20px;
    right: 25px;
    background: linear-gradient(90deg, #6200ff, #00b3ff);
    border: none;
    border-radius: 12px;
    color: white;
    font-size: 14px;
    font-weight: bold;
    padding: 10px 20px;
    cursor: pointer;
    text-transform: uppercase;
    box-shadow: 0 0 15px #00b3ff;
    transition: all 0.3s ease;
    z-index: 10;
  }

  .wallet-btn:hover {
    box-shadow: 0 0 25px #ff00e6;
    transform: scale(1.05);
  }

  /* === Wallet Info === */
  .wallet-info {
    position: fixed;
    top: 65px;
    right: 25px;
    background: rgba(20, 20, 40, 0.9);
    border: 2px solid rgba(120, 0, 255, 0.4);
    border-radius: 12px;
    padding: 12px 16px;
    font-size: 13px;
    line-height: 1.5;
    min-width: 240px;
    display: none;
    box-shadow: 0 0 20px rgba(180, 0, 255, 0.3);
  }

  .wallet-info span {
    color: #00ffff;
    font-weight: bold;
  }

  /* === Wheel Donut === */
  .wheel-container {
    position: relative;
    width: 320px;
    height: 320px;
    border-radius: 50%;
    background: radial-gradient(circle at center, #101020 30%, #1a0040 100%);
    box-shadow: 0 0 40px rgba(98,0,255,0.5), inset 0 0 25px rgba(0,255,255,0.2);
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .wheel-hole {
    position: absolute;
    width: 100px;
    height: 100px;
    border-radius: 50%;
    background: radial-gradient(circle, #000 60%, #111 100%);
    box-shadow: inset 0 0 25px #6c00ff;
  }

  .glow {
    position: absolute;
    width: 140%;
    height: 140%;
    top: -20%;
    left: -20%;
    background: radial-gradient(circle, rgba(98,0,255,0.25) 0%, transparent 70%);
    filter: blur(45px);
    z-index: -1;
  }

  /* === Controls === */
  .controls {
    margin-top: 40px;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 12px;
  }

  #placeBetBtn {
    background: linear-gradient(90deg, #00b3ff, #ff00e6);
    border: none;
    border-radius: 12px;
    color: white;
    font-size: 16px;
    font-weight: bold;
    padding: 12px 30px;
    cursor: pointer;
    text-transform: uppercase;
    box-shadow: 0 0 20px #00b3ff;
    transition: all 0.3s ease;
  }

  #placeBetBtn:hover {
    box-shadow: 0 0 25px #ff00e6;
    transform: scale(1.05);
  }

  .status {
    font-size: 13px;
    margin-top: 8px;
    color: #00b3ff;
  }
</style>
</head>

<body>
  <button class="wallet-btn" id="walletBtn">Connect Wallet</button>

  <!-- Wallet Info -->
  <div class="wallet-info" id="walletInfo">
    <p>Address: <span id="walletAddress">-</span></p>
    <p>Balance (ETH): <span id="ethBalance">0</span></p>
    <p>Balance (USDT): <span id="usdtBalance">0</span></p>
  </div>

  <div class="wheel-container" id="wheel">
    <div class="wheel-hole"></div>
    <div class="glow"></div>
  </div>

  <div class="controls">
    <button id="placeBetBtn">Place Bet</button>
    <div class="status" id="statusText">Wallet not connected</div>
  </div>

<script>
let provider, signer, userAddress;
const walletBtn = document.getElementById("walletBtn");
const walletInfo = document.getElementById("walletInfo");
const walletAddress = document.getElementById("walletAddress");
const ethBalance = document.getElementById("ethBalance");
const usdtBalance = document.getElementById("usdtBalance");
const statusText = document.getElementById("statusText");

// Ganti nanti dengan kontrak asli Faylotto
const USDT_ADDRESS = "0xYourUSDTContractAddress";
const USDT_ABI = [ "function balanceOf(address) view returns (uint256)" ];

// === Toggle Connect / Disconnect ===
async function toggleWallet() {
  if (!userAddress) {
    if (!window.ethereum) return alert("Please install MetaMask.");
    provider = new ethers.providers.Web3Provider(window.ethereum);
    await provider.send("eth_requestAccounts", []);
    signer = provider.getSigner();
    userAddress = await signer.getAddress();

    walletBtn.innerText = "Disconnect";
    walletInfo.style.display = "block";
    statusText.innerText = "Connected: " + userAddress.slice(0,6) + "..." + userAddress.slice(-4);
    walletAddress.innerText = userAddress;

    // Update ETH balance
    const balance = await provider.getBalance(userAddress);
    ethBalance.innerText = ethers.utils.formatEther(balance);

    // Update USDT balance
    try {
      const usdtContract = new ethers.Contract(USDT_ADDRESS, USDT_ABI, provider);
      const bal = await usdtContract.balanceOf(userAddress);
      usdtBalance.innerText = ethers.utils.formatUnits(bal, 6);
    } catch {
      usdtBalance.innerText = "Error / 0";
    }

  } else {
    provider = null;
    signer = null;
    userAddress = null;
    walletBtn.innerText = "Connect Wallet";
    statusText.innerText = "Wallet not connected";
    walletInfo.style.display = "none";
  }
}

// === Wheel Spin Animation ===
function spinWheel() {
  const wheel = document.getElementById("wheel");
  const angle = 360 * 5 + Math.floor(Math.random() * 360);
  gsap.to(wheel, {
    rotation: angle,
    duration: 5,
    ease: "power4.inOut",
    onComplete: () => {
      gsap.to(wheel, {rotation: angle % 360, duration: 0.5});
      alert("ðŸŽ¯ Spin complete!");
    }
  });
}

// === Place Bet ===
async function placeBet() {
  if (!signer) return alert("Connect wallet first!");

  const contractAddress = "0xYourContractAddressHere"; // ganti nanti
  const abi = [ "function placeBet() payable" ];

  const contract = new ethers.Contract(contractAddress, abi, signer);
  try {
    const tx = await contract.placeBet({ value: ethers.utils.parseEther("0.001") });
    statusText.innerText = "Bet placed... " + tx.hash.slice(0,10);
    await tx.wait();
    spinWheel();
  } catch (err) {
    console.error(err);
    alert("Transaction failed!");
  }
}

walletBtn.addEventListener("click", toggleWallet);
document.getElementById("placeBetBtn").addEventListener("click", placeBet);
</script>
</body>
</html>
