<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Faylotto Free Spin</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/ethers@6.6.4/dist/ethers.umd.min.js"></script>
<style>
  body {
    background: radial-gradient(circle, #111 0%, #000 100%);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    height: 100vh;
    color: #fff;
    font-family: "Ubuntu", sans-serif;
    overflow: hidden;
  }

  /* Kontrol Wallet (Kode Anda) */
  .wallet-controls {
    position: absolute;
    top: 25px;
    right: 25px;
    display: flex;
    flex-direction: row;
    gap: 10px;
  }

  .wallet-btn {
    background: linear-gradient(145deg, #00b4d8, #0077b6);
    border: none;
    border-radius: 10px;
    color: #fff;
    font-weight: bold;
    padding: 10px 18px;
    cursor: pointer;
    transition: 0.2s;
  }
  .wallet-btn:hover {
    transform: scale(1.05);
    background: linear-gradient(145deg, #48cae4, #0096c7);
  }
  .wallet-address {
    background: #222;
    border-radius: 10px;
    padding: 10px 16px;
    font-size: 14px;
    font-weight: bold;
    color: #0ff;
    border: 1px solid #0ff;
  }

  /* Roda (Kode Anda) */
  .wheel-container {
    position: relative;
    width: 350px;
    height: 350px;
  }
  svg {
    width: 100%;
    height: 100%;
    display: block;
  }
  #centerBtn {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 85px;
    height: 85px;
    border-radius: 50%;
    background: linear-gradient(145deg, #FFD700, #FFA500);
    color: black;
    font-weight: bold;
    font-size: 16px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    box-shadow: 0 8px 25px rgba(255, 215, 0, 0.6),
      inset 0 2px 4px rgba(255, 255, 255, 0.3);
    border: 3px solid #fff;
    transition: all 0.2s ease;
    z-index: 15;
  }
  #centerBtn:hover {
    transform: translate(-50%, -50%) scale(1.05);
  }
  #centerBtn:disabled {
    opacity: 0.6;
    cursor: not-allowed;
  }
  .result {
    margin-top: 30px;
    font-size: 20px;
    text-align: center;
    transition: all 0.5s ease;
    min-height: 30px;
  }

  /* INTEGRASI: CSS untuk Info Saldo */
  .info-container {
    display: flex;
    gap: 15px;
    margin-top: 20px;
  }
  .info-box {
    background: #222;
    border: 1px solid #0077b6;
    border-radius: 10px;
    padding: 10px 20px;
  }
  .info-box-title {
    font-size: 12px;
    color: #00b4d8;
    margin: 0;
  }
  .info-box-value {
    font-size: 24px;
    font-weight: bold;
    color: #fff;
    margin: 5px 0 0;
  }

  /* CSS Pointer dari kode Anda sebelumnya */
  .pointer {
      position: absolute; top: -5px; left: 50%; transform: translateX(-50%);
      width: 0; height: 0;
      border-left: 15px solid transparent;
      border-right: 15px solid transparent;
      border-top: 25px solid gold; /* Ganti warna pointer */
      z-index: 10;
      filter: drop-shadow(0 0 5px gold);
  }
</style>
</head>

<body>
  <div class="wallet-controls">
    <button id="connectBtn" class="wallet-btn">Connect Wallet</button>
    <button id="disconnectBtn" class="wallet-btn" style="display:none;">Disconnect</button>
    <div id="walletAddress" class="wallet-address" style="display:none;">-</div>
  </div>

  <div class="wheel-container">
    <div class="pointer"></div>
    <svg id="wheel" viewBox="0 0 500 500"></svg>
    <div id="centerBtn">FREE<br>SPIN</div>
  </div>

  <div class="result" id="resultText">Press SPIN to play</div>

  <div class="info-container">
    <div class="info-box">
      <h3 class="info-box-title">SISA SPIN</h3>
      <p class="info-box-value" id="spinCountText">2 / 2</p>
    </div>
    <div class="info-box">
      <h3 class="info-box-title">SALDO DUMMY (BABYDOGE)</h3>
      <p class="info-box-value" id="dummyBalanceText">0</p>
    </div>
  </div>

  <audio id="clickSound" src="click.mp3" preload="auto"></audio>
  <audio id="spinSound" src="spin.mp3" preload="auto" loop></audio>
  <audio id="winSound" src="win.mp3" preload="auto"></audio>

<script>
// === 1. INTEGRASI: KONFIGURASI KONTRAK ===
// Ganti dengan alamat kontrak Anda yang sudah di-deploy
const FAYLOTTO_ADDRESS = "0x10A57Be049bFF9bF84CBC952B73979c9cDb946Fe"; 

// ABI minimal yang diperlukan untuk halaman ini
const FAYLOTTO_ABI = [{"inputs":[{"internalType":"address","name":"_usdtToken","type":"address"},{"internalType":"address","name":"_babyDogeToken","type":"address"},{"internalType":"address","name":"_feeCollector","type":"address"}],"stateMutability":"nonpayable","type":"constructor"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"uint256","name":"roundId","type":"uint256"},{"indexed":true,"internalType":"address","name":"player","type":"address"},{"indexed":false,"internalType":"uint256","name":"amount","type":"uint256"}],"name":"BetBabyDoge","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"uint256","name":"roundId","type":"uint256"},{"indexed":true,"internalType":"address","name":"player","type":"address"},{"indexed":false,"internalType":"uint256","name":"amount","type":"uint256"}],"name":"BetDummy","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"uint256","name":"roundId","type":"uint256"},{"indexed":true,"internalType":"address","name":"player","type":"address"},{"indexed":false,"internalType":"uint256","name":"amount","type":"uint256"}],"name":"BetETH","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"uint256","name":"roundId","type":"uint256"},{"indexed":true,"internalType":"address","name":"player","type":"address"},{"indexed":false,"internalType":"uint256","name":"amount","type":"uint256"}],"name":"BetUSDT","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"uint256","name":"winnerId","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"commentId","type":"uint256"},{"indexed":true,"internalType":"address","name":"user","type":"address"},{"indexed":false,"internalType":"string","name":"text","type":"string"}],"name":"CommentAdded","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"uint256","name":"winnerId","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"commentId","type":"uint256"},{"indexed":true,"internalType":"address","name":"user","type":"address"},{"indexed":false,"internalType":"string","name":"newText","type":"string"}],"name":"CommentEdited","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"user","type":"address"}],"name":"FreeSpinNoPrize","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"user","type":"address"},{"indexed":false,"internalType":"uint256","name":"prizeTier","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"amount","type":"uint256"}],"name":"FreeSpinWon","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"user","type":"address"},{"indexed":false,"internalType":"string","name":"nickname","type":"string"}],"name":"NicknameCreated","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"uint256","name":"winnerId","type":"uint256"},{"indexed":true,"internalType":"address","name":"user","type":"address"},{"indexed":false,"internalType":"uint8","name":"stars","type":"uint8"}],"name":"Rated","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"user","type":"address"},{"indexed":false,"internalType":"uint256","name":"ethAmount","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"usdtAmount","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"babyDogeAmount","type":"uint256"}],"name":"ReferralRewardClaimed","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"user","type":"address"},{"indexed":true,"internalType":"address","name":"referrer","type":"address"}],"name":"ReferralSet","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"uint256","name":"roundId","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"startTime","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"endTime","type":"uint256"}],"name":"RoundCreated","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"uint256","name":"roundId","type":"uint256"},{"indexed":true,"internalType":"address","name":"winner","type":"address"},{"indexed":false,"internalType":"uint256","name":"rewardETH","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"rewardUSDT","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"rewardBabyDoge","type":"uint256"}],"name":"RoundFinalized","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"uint256","name":"winnerId","type":"uint256"},{"indexed":true,"internalType":"address","name":"user","type":"address"},{"indexed":false,"internalType":"bool","name":"liked","type":"bool"}],"name":"WinnerLiked","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"uint256","name":"winnerId","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"roundId","type":"uint256"},{"indexed":true,"internalType":"address","name":"winner","type":"address"},{"indexed":false,"internalType":"uint256","name":"rewardETH","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"rewardUSDT","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"rewardBabyDoge","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"timestamp","type":"uint256"}],"name":"WinnerRecorded","type":"event"},{"inputs":[],"name":"MAX_BETS_PER_PLAYER","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"MAX_BET_BABYDOGE","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"MAX_BET_ETH","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"MAX_BET_USDT","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"MAX_PLAYERS","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"MIN_BET_BABYDOGE","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"REF_BP","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"winnerId","type":"uint256"},{"internalType":"string","name":"text","type":"string"}],"name":"addCommentToWinner","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"to","type":"address"},{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"adminWithdrawBabyDoge","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"to","type":"address"},{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"adminWithdrawETH","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"to","type":"address"},{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"adminWithdrawUSDT","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"babyDogeToken","outputs":[{"internalType":"contract IERC20","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"claimReferralRewards","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"string","name":"nickname","type":"string"}],"name":"createNickname","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"currentRoundId","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"dummyBalances","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"dummyBetCost","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"winnerId","type":"uint256"},{"internalType":"uint256","name":"commentId","type":"uint256"},{"internalType":"string","name":"newText","type":"string"}],"name":"editCommentOnWinner","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"feeBP","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"feeCollector","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"rid","type":"uint256"}],"name":"finalizeRound","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"winnerId","type":"uint256"}],"name":"getAllCommentsForWinner","outputs":[{"components":[{"internalType":"address","name":"user","type":"address"},{"internalType":"string","name":"text","type":"string"},{"internalType":"uint256","name":"timestamp","type":"uint256"}],"internalType":"struct FaylottoSpinBattle.Comment[]","name":"","type":"tuple[]"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"winnerId","type":"uint256"}],"name":"getAllLikes","outputs":[{"internalType":"address[]","name":"","type":"address[]"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"winnerId","type":"uint256"}],"name":"getAverageRatingForWinner","outputs":[{"internalType":"uint256","name":"avgTimes1e18","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"winnerId","type":"uint256"}],"name":"getCommentCountForWinner","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"winnerId","type":"uint256"}],"name":"getLikeCount","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"rid","type":"uint256"},{"internalType":"address","name":"player","type":"address"}],"name":"getPlayerDeposits","outputs":[{"internalType":"uint256","name":"ethAmount","type":"uint256"},{"internalType":"uint256","name":"usdtAmount","type":"uint256"},{"internalType":"uint256","name":"babyDogeAmount","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"winnerId","type":"uint256"}],"name":"getRatingCountForWinner","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"user","type":"address"}],"name":"getReferralCount","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"user","type":"address"}],"name":"getReferralList","outputs":[{"internalType":"address[]","name":"","type":"address[]"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"user","type":"address"}],"name":"getReferralRewards","outputs":[{"internalType":"uint256","name":"ethReward","type":"uint256"},{"internalType":"uint256","name":"usdtReward","type":"uint256"},{"internalType":"uint256","name":"babyDogeReward","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"rid","type":"uint256"}],"name":"getRoundBasic","outputs":[{"internalType":"uint256","name":"id","type":"uint256"},{"internalType":"uint256","name":"startTime","type":"uint256"},{"internalType":"uint256","name":"endTime","type":"uint256"},{"internalType":"bool","name":"finalized","type":"bool"},{"internalType":"address","name":"winner","type":"address"},{"internalType":"uint256","name":"totalETH","type":"uint256"},{"internalType":"uint256","name":"totalUSDT","type":"uint256"},{"internalType":"uint256","name":"totalBabyDoge","type":"uint256"},{"internalType":"uint256","name":"playersCount","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"rid","type":"uint256"}],"name":"getRoundPlayers","outputs":[{"internalType":"address[]","name":"","type":"address[]"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"isFreeSpinPaused","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"","type":"uint256"}],"name":"likeCount","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"","type":"uint256"},{"internalType":"address","name":"","type":"address"}],"name":"liked","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"","type":"uint256"},{"internalType":"uint256","name":"","type":"uint256"}],"name":"likedBy","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"nextRoundId","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"string","name":"","type":"string"}],"name":"nicknameOwner","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"nicknames","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"owner","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"pauseFreeSpin","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"placeBetBabyDoge","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"placeBetDummy","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"ethValue","type":"uint256"}],"name":"placeBetETH","outputs":[],"stateMutability":"payable","type":"function"},{"inputs":[{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"placeBetUSDT","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"quotaTier1","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"quotaTier2","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"quotaTier3","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"quotaTier4","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"quotaTier5","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"quotaTier6","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"quotaTier7","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"winnerId","type":"uint256"},{"internalType":"uint8","name":"stars","type":"uint8"}],"name":"rateWinner","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"","type":"uint256"}],"name":"ratingCountByWinner","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"","type":"uint256"}],"name":"ratingTotalStars","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"","type":"uint256"},{"internalType":"address","name":"","type":"address"}],"name":"ratings","outputs":[{"internalType":"uint8","name":"","type":"uint8"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"referralRewardsBabyDoge","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"referralRewardsETH","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"referralRewardsUSDT","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"},{"internalType":"uint256","name":"","type":"uint256"}],"name":"referrals","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"referrerOf","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"roundLength","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"token","type":"address"}],"name":"setBabyDoge","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"cost","type":"uint256"}],"name":"setDummyBetCost","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"newFeeBP","type":"uint256"}],"name":"setFeeBP","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"newCollector","type":"address"}],"name":"setFeeCollector","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"string","name":"refNickname","type":"string"}],"name":"setReferralByNickname","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"secs","type":"uint256"}],"name":"setRoundLength","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"token","type":"address"}],"name":"setUSDT","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"spinCounts","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"spinFree","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"winnerId","type":"uint256"}],"name":"toggleLikeWinner","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"unpauseFreeSpin","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"usdtToken","outputs":[{"internalType":"contract IERC20","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"","type":"uint256"}],"name":"winnerList","outputs":[{"internalType":"uint256","name":"winnerId","type":"uint256"},{"internalType":"uint256","name":"roundId","type":"uint256"},{"internalType":"address","name":"winner","type":"address"},{"internalType":"uint256","name":"rewardETH","type":"uint256"},{"internalType":"uint256","name":"rewardUSDT","type":"uint256"},{"internalType":"uint256","name":"rewardBabyDoge","type":"uint256"},{"internalType":"uint256","name":"timestamp","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"","type":"uint256"}],"name":"winners","outputs":[{"internalType":"uint256","name":"winnerId","type":"uint256"},{"internalType":"uint256","name":"roundId","type":"uint256"},{"internalType":"address","name":"winner","type":"address"},{"internalType":"uint256","name":"rewardETH","type":"uint256"},{"internalType":"uint256","name":"rewardUSDT","type":"uint256"},{"internalType":"uint256","name":"rewardBabyDoge","type":"uint256"},{"internalType":"uint256","name":"timestamp","type":"uint256"}],"stateMutability":"view","type":"function"},{"stateMutability":"payable","type":"receive"}];
  
// === Variabel Global (Kode Anda) ===
let provider, signer, contract, userAddress;  
const btn = document.getElementById("centerBtn");  
const connectBtn = document.getElementById("connectBtn");  
const disconnectBtn = document.getElementById("disconnectBtn");  
const walletAddressDiv = document.getElementById("walletAddress");  
const resultText = document.getElementById("resultText");  
const clickSound = document.getElementById("clickSound");  
const spinSound = document.getElementById("spinSound");  
const winSound = document.getElementById("winSound");  
const svg = document.getElementById("wheel");

// INTEGRASI: Variabel UI baru
const spinCountText = document.getElementById("spinCountText");
const dummyBalanceText = document.getElementById("dummyBalanceText");
  
// === 2. INTEGRASI: PETA HADIAH ===
// Kita petakan 'tier' dari kontrak ke irisan roda visual
const prizes = [  
  { name: "10.000.000", icon: "bb.svg", tier: 6 }, // Tier 6 (Diff 1)
  { name: "5.000.000", icon: "bb.svg", tier: 1 }, // Tier 1 (Diff 6)
  { name: "8.500.000", icon: "bb.svg", tier: 4 }, // Tier 4 (Diff 3)
  { name: "No Prize", icon: "no.png", tier: 0 },   // '0' = No Prize
  { name: "9.000.000", icon: "bb.svg", tier: 5 }, // Tier 5 (Diff 2)
  { name: "1.000.000", icon: "bb.svg", tier: 7 }, // Tier 7 (Tambahan) & Tier 8 (TryAgain)
  { name: "6.500.000", icon: "bb.svg", tier: 2 }, // Tier 2 (Diff 5)
  { name: "7.500.000", icon: "bb.svg", tier: 3 }, // Tier 3 (Diff 4)
  { name: "Try again", icon: "again.png", tier: 0 } // '0' = No Prize
];  
  
const colors = [  
  "#FFB703","#FB8500","#219EBC","#8ECAE6","#FF69B4","#90EE90",  
  "#FFD700","#ff9f00","#40E0D0"  
];  
  
const radius = 240, cx = 250, cy = 250, total = prizes.length, slice = 360 / total;  
  
// Render Roda (Kode Anda - tidak perlu diubah)
for (let i = 0; i < total; i++) {  
  const startAngle = (i * slice - 90) * Math.PI / 180;  
  const endAngle = ((i + 1) * slice - 90) * Math.PI / 180;  
  const x1 = cx + radius * Math.cos(startAngle);  
  const y1 = cy + radius * Math.sin(startAngle);  
  const x2 = cx + radius * Math.cos(endAngle);  
  const y2 = cy + radius * Math.sin(endAngle);  
  
  const path = document.createElementNS("http://www.w3.org/2000/svg", "path");  
  path.setAttribute("d", `M ${cx} ${cy} L ${x1} ${y1} A ${radius} ${radius} 0 0 1 ${x2} ${y2} Z`);  
  path.setAttribute("fill", colors[i]);  
  path.setAttribute("stroke", "#fff");  
  path.setAttribute("stroke-width", "2");  
  svg.appendChild(path);  
  prizes[i].path = path; // Simpan referensi path
  
  const angle = (i + 0.5) * slice - 90;  
  
  const img = document.createElementNS("http://www.w3.org/2000/svg", "image");  
  const imgX = cx + radius * 0.55 * Math.cos(angle * Math.PI / 180) - 20;  
  const imgY = cy + radius * 0.55 * Math.sin(angle * Math.PI / 180) - 20;  
  img.setAttributeNS("http://www.w3.org/1999/xlink", "href", prizes[i].icon);  
  img.setAttribute("x", imgX);  
  img.setAttribute("y", imgY);  
  img.setAttribute("width", "40");  
  img.setAttribute("height", "40");  
  svg.appendChild(img);  
  
  const text = document.createElementNS("http://www.w3.org/2000/svg", "text");  
  const textX = cx + radius * 0.8 * Math.cos(angle * Math.PI / 180);  
  const textY = cy + radius * 0.8 * Math.sin(angle * Math.PI / 180);  
  text.setAttribute("x", textX);  
  text.setAttribute("y", textY);  
  text.setAttribute("fill", "#fff");  
  text.setAttribute("font-size", "15");  
  text.setAttribute("font-weight", "bold");  
  text.setAttribute("text-anchor", "middle");  
  text.setAttribute("alignment-baseline", "middle");  
  // Rotasi teks disesuaikan agar lurus
  text.setAttribute("transform", `rotate(${angle + 90}, ${textX}, ${textY})`);  
  text.textContent = prizes[i].name;  
  svg.appendChild(text);  
}  
  
let spinning = false, currentRotation = 0;  

// === Animasi Futuristik (Kode Anda - tidak perlu diubah) ===
function glowWinnerSector(winnerIndex) {
  // ... (Kode GSAP Anda yang canggih tetap di sini) ...
  const sector = prizes[winnerIndex].path;
  if (!sector) return;
  sector.style.filter = "drop-shadow(0 0 25px #00ffff) drop-shadow(0 0 50px #00ffff)";
  sector.style.stroke = "#00ffff";
  sector.style.strokeWidth = "3";
  gsap.to(sector, {
    scale: 1.08, rotation: "+=1", transformOrigin: "50% 50%",
    duration: 0.3, repeat: -1, yoyo: true, ease: "sine.inOut"
  });
  // ... (dan sisa kode glowWinnerSector Anda) ...
  // (Pembersih timeout 6 detik Anda juga bagus)
  setTimeout(() => {
    gsap.killTweensOf(sector);
    sector.style.filter = "";
    sector.style.stroke = "#fff";
    sector.style.strokeWidth = "2"; // kembali ke default svg
    gsap.to(sector, { scale: 1, rotation: 0, duration: 0.3 });
  }, 6000);
}

// === 3. INTEGRASI: FUNGSI SPIN (Diganti total) ===
async function spinFromBlockchain() {
  if (spinning || !contract) {
    resultText.textContent = "Harap hubungkan wallet dulu.";
    return;
  }
  
  spinning = true;
  btn.disabled = true;
  btn.textContent = "WAIT...";
  resultText.textContent = "Mengirim transaksi...";
  spinSound.play();

  try {
    // 1. Panggil `spinFree` di smart contract
    const tx = await contract.spinFree();
    resultText.textContent = "Menunggu konfirmasi blockchain...";

    // 2. Tunggu transaksi selesai
    const receipt = await tx.wait();

    // 3. Cari event di receipt untuk tahu hasilnya
    const { prizeTier, prizeAmount } = parseReceiptForPrize(receipt);
    
    // 4. Petakan hasil (Tier) ke irisan roda (Index)
    const winnerIndex = getTargetSlice(prizeTier);
    const winner = prizes[winnerIndex];

    // 5. Hitung rotasi untuk GSAP
    const sliceAngle = 360 / total;
    const randomExtra = 360 * 5; // 5 putaran ekstra
    // Dibalik agar mendarat di pointer (atas)
    const finalRotation = randomExtra + (360 - (winnerIndex * sliceAngle) - (sliceAngle / 2));

    // Animasi putaran utama
    gsap.to(svg, {
      rotation: `+=${finalRotation}`, // Rotasi relatif dari posisi sekarang
      duration: 5,
      ease: "power4.out",
      onUpdate: () => {
        // (opsional) mainkan clickSound di sini jika mau
        // clickSound.play();
      },
      onComplete: () => {
        if (prizeTier > 0) {
          winSound.play();
          resultText.textContent = `ðŸŽ‰ Anda menang: ${winner.name} BabyDoge! ðŸŽ‰`;
          glowWinnerSector(winnerIndex); // Panggil efek glow
        } else {
          resultText.textContent = "No Prize... Coba lagi di ronde utama!";
          glowWinnerSector(winnerIndex); // Tetap glow di "No Prize"
        }
        
        resetButton();
        updateUI(); // Update saldo & sisa spin
      }
    });

  } catch (err) {
    console.error("Spin failed:", err);
    resultText.textContent = "Spin Gagal! (Ditolak atau kuota habis)";
    resetButton();
  }
}

// === 4. INTEGRASI: FUNGSI HELPER BARU ===

// Helper untuk membaca event dari receipt
function parseReceiptForPrize(receipt) {
  const iface = new ethers.Interface(FAYLOTTO_ABI);
  for (const log of receipt.logs) {
    try {
      const parsedLog = iface.parseLog(log);
      if (parsedLog.name === "FreeSpinWon") {
        return {
          prizeTier: Number(parsedLog.args.prizeTier),
          prizeAmount: parsedLog.args.prizeAmount
        };
      }
      if (parsedLog.name === "FreeSpinNoPrize") {
        return { prizeTier: 0, prizeAmount: 0 };
      }
    } catch (e) { /* Abaikan log lain */ }
  }
  return { prizeTier: 0, prizeAmount: 0 }; // Default jika tidak ada event
}

// Helper untuk memetakan TIER KONTRAK ke INDEX RODA
function getTargetSlice(prizeTier) {
  let visualTier = prizeTier;
  
  // Kontrak kita: Tier 8 (dari 40% try again) adalah 1 Juta.
  // Kita petakan ke irisan visual Tier 7 (yang juga 1 Juta).
  if (visualTier === 8) {
    visualTier = 7;
  }

  // Cari semua irisan di roda yang cocok dengan tier
  const matchingSlices = [];
  for (let i = 0; i < prizes.length; i++) {
    if (prizes[i].tier === visualTier) {
      matchingSlices.push(i);
    }
  }

  // Jika ada beberapa (misal "No Prize"), pilih acak salah satunya
  if (matchingSlices.length > 0) {
    const randomIndex = Math.floor(Math.random() * matchingSlices.length);
    return matchingSlices[randomIndex];
  }

  // Fallback (seharusnya tidak terjadi)
  return 3; // Index dari "No Prize"
}

// Helper untuk update saldo & sisa spin
async function updateUI() {
  if (!contract) return;
  try {
    // 1. Baca sisa spin
    const spins = await contract.spinCounts(userAddress);
    const spinsLeft = 2 - Number(spins);
    spinCountText.textContent = `${spinsLeft < 0 ? 0 : spinsLeft} / 2`;

    // 2. Baca saldo dummy (kontrak kita pakai 9 desimal untuk hadiah)
    const balance = await contract.dummyBalances(userAddress);
    dummyBalanceText.textContent = ethers.formatUnits(balance, 9);
    
  } catch (err) {
    console.error("Error updating UI:", err);
  }
}
  
// === 5. FUNGSI BAWAAN ANDA (Di-update) ===

// Base Sepolia (Kode Anda)
const BASE_SEPOLIA = {
  chainIdHex: '0x14a34', chainIdDec: 84532, chainName: 'Base Sepolia',
  rpcUrls: ['https://sepolia.base.org'],
  nativeCurrency: { name: 'Ether', symbol: 'ETH', decimals: 18 },
  blockExplorerUrls: ['https://sepolia.basescan.org']
};

// Fungsi utilitas (Kode Anda)
function shortAddress(addr) { return addr ? addr.slice(0, 6) + "..." + addr.slice(-4) : ""; }
function hasEthereum() { return typeof window !== 'undefined' && !!window.ethereum; }
function getLocalDateTimeString() { return new Date().toLocaleString(); }
function saveSignature(wallet, signature) { /* ... (Kode Anda) ... */ }
function getSignature() { /* ... (Kode Anda) ... */ }
async function ensureBaseSepolia() { /* ... (Kode Anda) ... */ }

// === Fungsi utama: connect wallet (DI-UPDATE) ===
async function connectWallet() {
  try {
    if (!hasEthereum()) {
      alert("ðŸ¦Š Silakan instal MetaMask terlebih dahulu.");
      return;
    }

    await ensureBaseSepolia(); // Kode Anda

    provider = new ethers.BrowserProvider(window.ethereum);
    await provider.send("eth_requestAccounts", []);
    signer = await provider.getSigner();
    userAddress = await signer.getAddress();

    // ... (Logika signature Anda) ...

    // === INTEGRASI: Inisialisasi Kontrak ===
    contract = new ethers.Contract(FAYLOTTO_ADDRESS, FAYLOTTO_ABI, signer);

    // Update UI (Kode Anda)
    connectBtn.style.display = "none";
    disconnectBtn.style.display = "inline-block";
    walletAddressDiv.style.display = "inline-block";
    walletAddressDiv.textContent = shortAddress(userAddress);

    // === INTEGRASI: Panggil updateUI() ===
    await updateUI();
    resultText.textContent = "Wallet terhubung! Silakan spin.";

    // Listener (Kode Anda)
    window.ethereum.on('accountsChanged', (accounts) => {
      if (!accounts.length) disconnectWallet();
      else {
        userAddress = accounts[0];
        walletAddressDiv.textContent = shortAddress(userAddress);
        connectWallet(); // Hubungkan ulang untuk user baru
      }
    });
    window.ethereum.on('chainChanged', (chainIdHex) => {
      if (chainIdHex !== BASE_SEPOLIA.chainIdHex) connectWallet(); // Paksa konek ulang
    });

  } catch (err) {
    console.error("connectWallet error:", err);
    resultText.textContent = "Koneksi wallet gagal.";
  }
}

// === Fungsi disconnect (DI-UPDATE) ===
function disconnectWallet() {
  provider = signer = contract = userAddress = null;
  connectBtn.style.display = "inline-block";
  disconnectBtn.style.display = "none";
  walletAddressDiv.style.display = "none";
  
  // Reset info
  resultText.textContent = "Press SPIN to play";
  spinCountText.textContent = "2 / 2";
  dummyBalanceText.textContent = "0";
}
  
function resetButton() {  
  spinning = false;
  btn.disabled = false;  
  btn.textContent = "FREE SPIN";  
  spinSound.pause();
  spinSound.currentTime = 0; // Reset audio
}  
  
// === Event Listeners (Kode Anda) ===
connectBtn.addEventListener("click", connectWallet);  
disconnectBtn.addEventListener("click", disconnectWallet);  
btn.addEventListener("click", spinFromBlockchain);
</script>

</body>
</html>
