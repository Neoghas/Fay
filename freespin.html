<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Faylotto Free Spin</title>
<link href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/ethers@6.6.4/dist/ethers.umd.min.js"></script>

  <style>
  body {
    background: radial-gradient(circle, #111 0%, #000 100%);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    min-height: 100vh; height: auto;
    color: #fff;
    font-family: "Ubuntu", sans-serif;
    overflow-x: hidden;
    padding: 20px 0;
  }

   /* === NAVBAR === */
  .navbar {
  width: 100%;
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 12px 25px;
  position: fixed;
  top: 0;
  left: 0;
  z-index: 50;
  box-sizing: border-box;
  
  /* === PERUBAHAN GLASSMORPHISM === */
  
  /* 1. Warna kaca semi-transparan (sedikit putih) */
  background-color: rgba(255, 255, 255, 0.05); 
  
  /* 2. Efek blur pada konten di belakang navbar */
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px); /* Untuk kompatibilitas Safari */
  
  /* 3. Border tipis untuk mempertegas tepi "kaca" */
  border-bottom: 1px solid rgba(255, 255, 255, 0.1);
  
  /* 4. Shadow lama Anda, opacity-nya sedikit dikurangi agar lebih halus */
  box-shadow: 0 2px 20px rgba(0, 180, 216, 0.1);
  }

    /* === NAVBAR LOGO PERBAIKAN === */
.navbar-logo {
  /* 1. Mengatur perataan logo dan teks */
  display: flex;
  align-items: center; /* Kunci: Rata tengah vertikal */
  gap: 10px;           /* Jarak antara logo dan teks */
  
  /* 2. Style untuk teks "Faylotto" */
  font-size: 22px;     /* Ukuran font ideal */
  font-weight: 700;    /* Bold */
  
  /* 3. Gradient warna sesuai permintaan */
  background: linear-gradient(90deg, #03a9f4, #f441a5);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
}
    
  .navbar-logo img {
    height: 42px;
    filter: drop-shadow(0 0 4px rgba(255,255,255,0.3));
  }
  .wallet-btn {
    background: background: linear-gradient(90deg, #03a9f4, #f441a5);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
    border: 2px solid #6600ff;
    border-radius: 12px;
    color: #fff;
    font-weight: bold;
    padding: 10px 18px;
    cursor: pointer;
    transition: 0.2s;
    box-shadow: 0 0 10px rgba(0,180,216,0.3);
  }
  .wallet-btn:hover {
    transform: scale(1.05);
    box-shadow: 0 0 15px rgba(0,180,216,0.6);
  }

  /* === HERO SECTION === */
  .hero {
    text-align: center;
    padding: 140px 20px 60px; /* tambah jarak karena navbar fixed */
  }
  .hero h1 {
    font-size: 42px;
    background: linear-gradient(90deg, #03a9f4, #f441a5);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
    text-shadow: 0 0 20px rgba(0,180,216,0.6);
    margin-bottom: 15px;
  }
  .hero p {
    font-size: 18px;
    color: #ccc;
    max-width: 600px;
    margin: 0 auto;
  }

  /* === MAIN CONTENT (Wheel & Info) === */
  .wheel-container {
  position: relative;
  width: 350px;
  height: 350px;
  margin: 60px auto 0;
  border-radius: 50%;
  overflow: hidden;
  z-index: 0;
  background: #0a0a0f;
}

/* efek border gradasi */
.wheel-container::before {
  content: "";
  position: absolute;
  inset: 1px; /* keluar sedikit biar efek kelihatan */
  border-radius: 50%;
  padding: 40px;
  background: linear-gradient(35deg, rgb(47, 190, 238), rgb(218, 57, 143), rgb(139, 255, 23));
  -webkit-mask:
    linear-gradient(#fff 0 0) content-box,
    linear-gradient(#fff 0 0);
  -webkit-mask-composite: xor;
          mask-composite: exclude;
  z-index: -1;
  filter: blur(10px);
  animation: spinborder 4s linear infinite;
}

  svg { width: 100%; height: 100%; display: block; }
  #centerBtn {
    position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
    width: 85px; height: 85px; border-radius: 50%;
    background: radial-gradient(circle, #03a9f4, #f441a5);
    color: fff; font-weight: bold; font-size: 16px;
    display: flex; align-items: center; justify-content: center;
    cursor: pointer;
    box-shadow: 0 8px 25px rgba(255, 215, 0, 0.6), inset 0 2px 4px rgba(255, 255, 255, 0.3);
    border: 3px solid #fff; transition: all 0.2s ease; z-index: 15;
  }
  #centerBtn:hover { transform: translate(-50%, -50%) scale(1.05); }

  .result {
    margin-top: 30px; font-size: 15px; color: #01b300; font-family: "Ubuntu", sans-serif; text-align: center;
    transition: all 0.5s ease; min-height: 30px;
  }

  .info-container {
  display: flex;
  flex-direction: row; /* <-- TAMBAHKAN BARIS INI */
  gap: 15px;
  margin-top: 20px;
  width: 90%;
  max-width: 500px;
  }

/* Kotak Individual: (Box 1 dan Box 2) */
.info-box {
  background: #222;
  border: 2px solid #6600ff;
  border-radius: 10px;
  padding: 10px 20px;
  
  /* Ini akan membuat kedua box sama lebar */
  flex-grow: 1;
  flex-basis: 0;

  /* Ini menumpuk Judul di atas Nilai */
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 5px;
}

/* Judul (mis: "Spin Quota") */
.info-box-title {
  font-size: 12px;
  color: #ccc;
  margin: 0;
  font-weight: bold;
}

/* Kontainer untuk [Icon] + [Nilai] */
.info-box-value {
  display: flex;
  align-items: center;
  gap: 10px; /* Jarak antara ikon dan angka */
  font-size: 20px;
  font-weight: bold;
  color: #00b4d8;
  margin: 0; /* Hapus margin default jika ada <p> */
}

/* Ikon di dalam box */
.info-icon {
  width: 20px;
  height: 20px;
  object-fit: contain;
}
    
    .pointer {
      position: absolute; top: -5px; left: 50%; transform: translateX(-50%);
      width: 0; height: 0; max-width: 450px;
      border-left: 15px solid transparent; border-right: 15px solid transparent;
      border-top: 25px solid gold; z-index: 10;
      filter: drop-shadow(0 0 5px green);
  }
    
  /* === REFERRAL BOX === */
  .referral-container {
    background: #1a1a1a; border: 1px solid #00b4d8; border-radius: 15px;
    width: 90%; max-width: 600px; padding: 20px;
    margin: 40px auto; box-shadow: 0 0 30px rgba(0, 180, 216, 0.5);
  }
  .referral-header {
    text-align: center; background: linear-gradient(90deg, #03a9f4, #f441a5);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent; margin-top: 0;
    padding-bottom: 10px; border-bottom: 1px solid #0077b6;
  }
  .ref-section {
    background: #222; border-radius: 10px; padding: 15px;
    margin-bottom: 15px; border: 2px solid #1f004c;
  }
  .ref-section h3 { margin-top: 0; background: linear-gradient(90deg, #03a9f4, #f441a5);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent; }
  .ref-info { font-size: 14px; line-height: 1.6; }
  .ref-info span { color: #0ff; font-weight: bold; }
  .input-group { display: flex; }
  .input-group input {
    flex-grow: 1; background: #001119; border: 1px solid #0077b6;
    color: white; padding: 10px; border-radius: 5px;
  }
    .input-group input:focus {
  box-shadow: 2px 2px 15px #0074b3 inset;
    }
  .ref-btn {
    background: linear-gradient(90deg, #03a9f4, #f441a5);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
    background-size: 200%;
    border-radius: 25px;
    border: 2px solid #6600ff;
    color: #fff;
    font-weight: 700;
    font-size: 16px;
    padding: 8px 28px;
    cursor: pointer;
    letter-spacing: 1px;
    transition: all 0.3s ease;
    box-shadow: 0 0 15px rgba(122, 95, 255, 0.4);
    animation: glowPulse 3s ease-in-out infinite alternate;
  }

  .center-btn {
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100%; /* penuh tinggi layar */
  }

  .ref-btn:hover {
    transform: scale(1.08);
    background-position: 200% center;
    box-shadow: 0 0 25px #ff4ecd, 0 0 50px #7a5fff;
    border-color: #b388ff;
  }

  @keyframes glowPulse {
    0% {
      box-shadow: 0 0 10px rgba(0, 212, 255, 0.3),
                  0 0 20px rgba(122, 95, 255, 0.2);
    }
    100% {
      box-shadow: 0 0 25px rgba(255, 78, 205, 0.6),
                  0 0 50px rgba(122, 95, 255, 0.5);
    }
  }
    
  /* === FOOTER === */
  footer {
    margin-top: 50px;
    width: 100%;
    background: rgba(0, 0, 0, 0.8);
    text-align: center;
    padding: 20px 0;
    border-top: 1px solid #0077b6;
  }
  .social-icons a {
    color: #333333;
    margin: 0 10px;
    font-size: 22px;
    transition: 0.3s;
  }
  .social-icons a:hover {
    color: #00b4d8;
    transform: scale(1.2);
  }
  .footer-text {
    color: #aaa;
    margin-top: 10px;
    font-size: 14px;
  }

  h4, h5, h6 {
  color: #b3b3b3;
}

h1, h2, h3 {
  background: linear-gradient(90deg, #03a9f4, #f441a5);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
}

    

.btn-rec {
  --width: 140px;
  --height: 60px;
  --padding: 6px;
  --border-radius: 30px;
  --dot-size: 12px;
  --btn-color: #202020;
  --hue: 140deg; /* üî∏ Hijau gelap elegan */
  --animation-duration: 1.5s;

  position: relative;
  display: flex;
  align-items: center;
  justify-content: center;
  width: var(--width);
  height: var(--height);
  border-radius: var(--border-radius);
  border: none;
  background-color: #00000008;

  box-shadow:
    1px 1px 2px 0 #0f0d,
    2px 2px 2px #0001 inset,
    2px 2px 8px #0002 inset;

  transition: box-shadow 50ms linear;
  perspective: 150px;
  user-select: none;
  z-index: 1;
}

.btnrec {
  display: flex;
  align-items: center;
  justify-content: start;
  gap: 0.25em;
  padding: 0 var(--height) 0 calc(var(--padding) * 4);
  width: calc(100% - 2 * var(--padding));
  height: calc(100% - 2 * var(--padding));
  border-radius: calc(var(--border-radius) - var(--padding));
  border: none;
  cursor: pointer;
  background: linear-gradient(#fff2, #0001), var(--btn-color);
  box-shadow:
    0 2px 1px #00000010,
    0 4px 2px #00000010,
    0 8px 4px #00000010;
  transition:
    transform 0.25s cubic-bezier(0.25, 1.5, 0.5, 2.2),
    box-shadow 0.25s cubic-bezier(0.25, 1.5, 0.5, 1),
    filter 0.3s cubic-bezier(0.25, 1.5, 0.5, 1);
}

.btn-txt {
  font-size: 16px;
  font-weight: 600;
  font-family: "Ubuntu", sans-serif;
  color: #ccc;
  letter-spacing: 1px;
  transition: color 0.3s ease;
}

.dot {
  position: absolute;
  top: calc(50% - var(--dot-size) / 2);
  right: calc(var(--height) / 2 - var(--padding) / 2);
  width: var(--dot-size);
  aspect-ratio: 1/1;
  border-radius: 50%;
  background-color: hsla(var(--hue), 30%, 30%, 0.4);
  border: 1px solid hsla(var(--hue), 50%, 50%, 0.6);
  box-shadow:
    0 0 5px 1px hsla(var(--hue), 60%, 45%, 0.6),
    0 0 12px 4px hsla(var(--hue), 70%, 40%, 0.3);
  z-index: 3;
  transition: transform 0.3s ease;
}

.dot::after {
  content: "";
  position: absolute;
  inset: -4px;
  border-radius: inherit;
  background-color: #0000;
  box-shadow:
    0 0 12px 2px hsla(var(--hue), 70%, 40%, 0.5),
    0 0 25px 10px hsla(var(--hue), 70%, 40%, 0.4),
    0 0 60px 15px hsla(var(--hue), 80%, 50%, 0.3);
  opacity: 0;
  transition: opacity 0.3s ease;
}

/* üåü Hover efek lembut + teks bersinar */
.btnrec:hover .btn-txt {
  color: #fff;
  text-shadow: 0 0 10px hsla(var(--hue), 80%, 60%, 0.8);
}
.btnrec:hover .dot {
  transform: scale(1.15);
}
.btnrec:hover .dot::after {
  opacity: 1;
}

/* üîÅ Denyut halus otomatis */
@keyframes pulse {
  0%, 100% {
    transform: scale(1);
    filter: brightness(1);
  }
  50% {
    transform: scale(1.05);
    filter: brightness(1.2);
  }
}

.btnrec:hover {
  animation: pulse 1.8s ease-in-out infinite;
}

/* Fokus = animasi nyala */
@keyframes bg-anim {
  0%, 100% { background-color: hsla(var(--hue), 50%, 50%, 0); }
  50% { background-color: hsla(var(--hue), 100%, 50%, 1); }
}
@keyframes opacity-anim {
  0%, 100% { opacity: 0; }
  50% { opacity: 1; }
}

.btnrec:focus .dot {
  animation: bg-anim var(--animation-duration) ease-in-out infinite;
}
.btnrec:focus .dot::after {
  animation: opacity-anim var(--animation-duration) ease-in-out infinite;
}

    /* === FAQ CYBERPUNK STYLE === */
.faq-section {  
    background: #1a1a1a;
    border: 1px solid #00b4d8;
    border-radius: 15px;
    width: 90%;
    max-width: 600px;
    padding: 20px;
    margin: 40px auto;
    box-shadow: 0 0 30px rgba(0, 180, 216, 0.5);
    }

.faq-title {
  text-align: center;
  font-size: 26px;
  font-weight: 700;
  margin-bottom: 25px;
  background: linear-gradient(90deg, #03a9f4, #f441a5);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
}

.faq-item {
  margin-bottom: 15px;
  border: 1px solid #1f004c;
  border-radius: 10px;
  overflow: hidden;
  background: linear-gradient(145deg, rgba(30,30,50,0.9), rgba(10,10,25,0.8));
  box-shadow: 0 0 10px rgba(100, 0, 255, 0.2);
  transition: all 0.3s ease;
}

.faq-item:hover {
  box-shadow: 0 0 20px rgba(244,65,165,0.4);
}

.faq-question {
  width: 100%;
  background: none;
  border: none;
  color: #00d4ff;
  font-size: 17px;
  font-weight: 700;
  text-align: left;
  padding: 15px 20px;
  cursor: pointer;
  position: relative;
  transition: all 0.3s;
}

.faq-question::after {
  content: "+";
  position: absolute;
  right: 20px;
  font-size: 20px;
  color: #f441a5;
  transition: transform 0.3s ease;
}

.faq-item.active .faq-question::after {
  transform: rotate(45deg);
}

.faq-answer {
  max-height: 0;
  overflow: hidden;
  background: rgba(0,0,0,0.3);
  color: #ccc;
  font-size: 15px;
  line-height: 1.6;
  padding: 0 20px;
  border-top: 1px solid #330066;
  transition: max-height 0.4s ease, padding 0.3s ease;
}

.faq-item.active .faq-answer {
  max-height: 200px;
  padding: 15px 20px;
}

/* === MODAL STYLE (FUTURISTIC & COMPACT) === */
.modal {
  display: none; /* Sembunyi by default */
  position: fixed; 
  z-index: 1000;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  overflow: auto;
  background-color: transparent; /* Sesuai permintaan: tanpa overlay */
  animation: fadeIn 0.3s ease;
}

/* === KOTAK MODAL UTAMA === */
.modal-content {
  /* PERUBAHAN: Dibuat padat & futuristik */
  width: 92%;
  max-width: 340px; /* Lebih compact */
  background: #0e0e0e; /* Latar belakang sangat gelap */
  border: 1px solid #280066; /* Border halus */
  border-radius: 18px;
  padding: 18px 20px;
  margin: 10% auto;
  box-shadow: 0 0 15px rgba(0, 255, 255, 0.08); /* Efek glow cyan halus */
  position: relative;
}

/* === JUDUL === */
.modal-content h3 {
  margin-top: 0;
  margin-bottom: 15px;
  font-size: 18px;
  color: #00eaff; /* Warna neon */
  text-align: center;
}

/* === TOMBOL CLOSE (X) === */
.close-btn {
  position: absolute;
  right: 12px;
  top: 12px;
  cursor: pointer;
  font-size: 22px;
  color: #ff6666;
  transition: 0.2s;
}
.close-btn:hover {
  color: #ff0000;
}

/* === ITEM INFO (Menggunakan Grid) === */
.modal-info-item {
  /* Menggunakan Grid agar rapi: [Label] [Value] [Icon] */
  display: grid;
  grid-template-columns: 85px 1fr auto; /* Lebar Label, Value (flex), Lebar Ikon */
  align-items: center;
  gap: 10px; /* Jarak antar kolom */
  
  /* Tampilan item */
  margin-bottom: 10px;
  background: #151515; /* Latar item sedikit beda */
  padding: 8px 10px;
  border-radius: 10px;
  border: 1px solid #1f1f1f;
}

/* === LABEL (Address, Nickname, dll) === */
.modal-info-item h5,
.modal-info-item h6 { /* (Saya sertakan h6 jika Anda lupa perbaiki typo) */
  margin: 0;
  font-size: 13px;
  color: #8f8f8f; /* Abu-abu */
  font-weight: 400; /* Tipis */
}

/* === VALUE (Isi data) === */
.modal-info-item strong {
  font-size: 13px;
  color: #009907;
  word-break: break-all;
  text-align: left; /* Rata kiri */
}

/* === IKON (di paling kanan) === */
.info-icon {
  width: 20px;
  height: 20px;
  opacity: 0.8;
  justify-self: end; /* Paksa ke paling kanan grid */
}

/* === TOMBOL DISCONNECT (BARU) === */
.modal-disconnect-btn {
  width: 50%;
  margin-top: 10px;
  padding: 10px 0; /* Tidak terlalu "panjang" (tinggi) */
  font-size: 14px;
  border-radius: 10px;
  
  /* Estetika baru: Merah gelap */
  background: #2a0f10;
  border: 1px solid #ff4a4a;
  color: #ff4a4a;
  -webkit-text-fill-color: #ff4a4a; /* Override jika ada */
  transition: 0.2s;
}

.modal-disconnect-btn:hover {
  background: #3d1315; /* Sedikit lebih terang */
  border-color: #ff5e5e;
  color: #ff5e5e;
  -webkit-text-fill-color: #ff5e5e;


/* === RESPONSIVE === */
  @media (min-width: 768px) {
    .wheel-container { width: 500px; height: 500px; }
  }

  @media (min-width: 1024px) {
    .hero h1 { font-size: 52px; }
    .hero p { font-size: 20px; }
    .wheel-container { width: 550px; height: 550px; }
    .info-box { padding: 15px 30px; }
    .info-box-value { font-size: 23px; }
  }

/* Animasi */
@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}
@keyframes fadeIn {
  from { opacity: 0; transform: translateY(10px); }
  to { opacity: 1; transform: translateY(0); }
}

  

    /* animasi berputar */
@keyframes spinborder {
  to {
    transform: rotate(360deg);
  }
}
</style>

<body>
  <!-- NAVBAR -->
  <div class="navbar">
    <div class="navbar-logo">
      <img src="logo.svg" alt="Logo"> Faylotto
    </div>
    <button id="connectBtn" class="wallet-btn">Connect Wallet</button>
  </div>

  <!-- HERO -->
  <section class="hero">
    <h2>Faylotto Decentralized Betting Web3 Social</h2>
    <h3>Spin & Win Rewards!</h3>
    <h5>Spin your wheel of fortune and win exciting BabyDoge prizes. Start playing now for free!</h5><br>
    <center>
    <a href="#wheel" style="text-decoration: none;">
    <div class="btn-rec">
    <button class="btnrec">
      <span class="btn-txt">Play!</span>
      <div class="dot"></div>
    </button>
    </div></a></center>
  </section>

  <!-- WHEEL -->
  <div class="wheel-container">
    
    <svg id="wheel" viewBox="0 0 500 500"></svg>
    <div id="centerBtn">FREE<br>SPIN</div>
  </div>

  <div class="result" id="resultText">Press SPIN to play</div>
  
  <div class="info-container">

  <div class="info-box">
    <h3 class="info-box-title">Spin Quota:</h3>
    <div class="info-box-value">
      <img src="win.png" alt="Spin Icon" class="info-icon">
      <span id="spinCountText">0 / 2</span>
    </div>
  </div>

  <div class="info-box">
    <h3 class="info-box-title">Balance BabyDoge:</h3>
    <div class="info-box-value">
      <img src="bb.svg" alt="Balance Icon" class="info-icon">
      <span id="dummyBalanceText">0</span>
    </div>
  </div>
  </div>
  
  <!-- REFERRAL SYSTEM -->
  <div class="referral-container">
    <h2 class="referral-header">Referral System</h2>
    <div class="ref-section">
        <h3>My Info</h3>
        <div class="ref-info">
            My Nickname: <span id="myNickname">-</span><br/>
            My Referrer: <span id="myReferrer">-</span>
        </div>
    </div>
    <div class="ref-section">
        <h3>Create Nickname / Update</h3>
        <div class="input-group">
            <input type="text" id="nicknameInput" placeholder=" Create your nickname....">
        </div>
        <br>
        <div class="center-btn">
        <button id="createNicknameBtn" class="ref-btn">Create</button>
    </div>
    </div>
    <div class="ref-section" id="referralLinkSection" style="display: none;">
          <h3>Your Referral Link</h3>
          <div class="input-group">
              <input type="text" id="referralLinkInput" readonly style="cursor: pointer;">
          </div><br>
           <div class="center-btn">
          <button id="copyReferralBtn" class="ref-btn">Copy Link</button>
    </div>
    </div>
    <div class="ref-section">
      <h3>My Rewards</h3>
      <div class="ref-info">
          <img src="eth.svg" width="22" height="22" style="vertical-align: middle; margin-right: 5px;">
          ETH Rewards: <span id="ethRewards">0</span><br/>
          <img src="usdt.svg" width="22" height="22" style="vertical-align: middle; margin-right: 5px;">
          USDT Rewards: <span id="usdtRewards">0</span><br/>
          <img src="bb.svg" width="22" height="22" style="vertical-align: middle; margin-right: 5px;">
          BabyDoge Rewards: <span id="babyDogeRewards">0</span><br/>
          <hr style="border-color: #0077b6; margin: 10px 0;">
          <img src="nick.svg" width="22" height="22" style="vertical-align: middle; margin-right: 5px;">
          Total Referrals: <span id="referralCount">0</span>
      </div>
      <br>
      <div class="center-btn">
      <button id="claimRewardsBtn" class="ref-btn">Claim Rewards</button>
    </div>
  </div>
  </div>

  <div id="walletModal" class="modal">
    <div class="modal-content">
      <span id="modalCloseBtn" class="close-btn">&times;</span>
      <h3>Wallet Info</h3>
      
      <div class="modal-info-item">
        <h5>Address:</h5>
        <strong id="modalWalletAddress">-</strong>
        <img src="wallet.svg" class="info-icon" alt="">
      </div>
      
      <div class="modal-info-item">
         <h5>Nickname:</h5>
          <strong id="modalNickname">-</strong>
          <img src="nick.svg" class="info-icon" alt="">
      </div>
      
      <div class="modal-info-item">
        <h5>Balance:</h5>
        <strong id="modalEthBalance">0</strong>
        <img src="eth.svg" class="info-icon" alt="">
      </div>
      
      <div class="modal-info-item">
        <h5>Free Balance:</h5>
        <strong id="modalFreeBalance">0</strong>
        <img src="bb.svg" class="info-icon" alt="">
      </div>
      
      <center><button id="modalDisconnectBtn" class="ref-btn modal-disconnect-btn">Disconnect</button></center>
    </div>
  </div>

  <section class="faq-section">
  <h2 class="faq-title">‚ùì FAQ ‚Äî Pertanyaan Umum</h2>
  <div class="faq-container">
    <div class="faq-item">
      <button class="faq-question">Apa itu Faylotto Free Spin?</button>
      <div class="faq-answer">Faylotto Free Spin adalah permainan berbasis blockchain di mana Anda bisa mendapatkan hadiah gratis hanya dengan menghubungkan wallet.</div>
    </div>

    <div class="faq-item">
      <button class="faq-question">Apakah saya perlu membayar untuk spin?</button>
      <div class="faq-answer">Tidak, Anda mendapat spin gratis setiap hari. Namun Anda bisa meningkatkan peluang dengan referral aktif.</div>
    </div>

    <div class="faq-item">
      <button class="faq-question">Bagaimana cara mendapatkan referral bonus?</button>
      <div class="faq-answer">Gunakan tautan referral unik Anda dan bagikan ke teman. Setiap pengguna baru yang bergabung memberi Anda tambahan quota spin.</div>
    </div>

    <div class="faq-item">
      <button class="faq-question">Apakah hadiah dikirim langsung ke wallet?</button>
      <div class="faq-answer">Ya, semua hadiah dikirim otomatis ke alamat wallet yang terhubung setelah spin berakhir.</div>
    </div>

    <div class="faq-item">
      <button class="faq-question">Apakah Faylotto aman?</button>
      <div class="faq-answer">Faylotto menggunakan smart contract publik di jaringan Base Sepolia dan audit internal untuk menjaga transparansi.</div>
    </div>

    <div class="faq-item">
      <button class="faq-question">Token apa yang digunakan untuk reward?</button>
      <div class="faq-answer">Hadiah dapat berupa ETH testnet atau token USDT testnet tergantung event aktif pada saat itu.</div>
    </div>
  </div>
  </section>

  <audio id="clickSound" src="click.mp3" preload="auto"></audio>
  <audio id="spinSound" src="spin.mp3" preload="auto" loop></audio>
  <audio id="winSound" src="win.mp3" preload="auto"></audio>

  <!-- === FOOTER === -->
  <footer>
    <div class="social-icons">
      <a href="#"><i class="fa-brands fa-x-twitter"></i></a>
      <a href="#"><i class="fa-brands fa-telegram"></i></a>
      <a href="#"><i class="fa-brands fa-telegram"></i></a>
      <a href="mailto:support@faylotto.com"><i class="fa-solid fa-envelope"></i></a>
    </div>
    <div class="footer-text">¬© 2025 Faylotto. All rights reserved.</div>
  </footer>

  <script>
// === 1. KONFIGURASI KONTRAK ===

// !!! PENTING: ISI DENGAN ALAMAT KONTRAK V3 BARU ANDA
const FAYLOTTO_ADDRESS = "0xBf629CdE40f4F15de7be7d497741abe7D7C61afB"; 

// PERBAIKAN: Sesuai permintaan Anda, ABI tidak ditampilkan di sini, 
// namun pastikan Anda MENGGUNAKAN ABI LENGKAP yang ada di file asli Anda.
const FAYLOTTO_ABI = [{"inputs":[{"internalType":"address","name":"_usdtToken","type":"address"},{"internalType":"address","name":"_babyDogeToken","type":"address"},{"internalType":"address","name":"_feeCollector","type":"address"},{"internalType":"address","name":"_nativeUsdPriceFeedAddress","type":"address"}],"stateMutability":"nonpayable","type":"constructor"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"uint256","name":"roundId","type":"uint256"},{"indexed":true,"internalType":"address","name":"player","type":"address"},{"indexed":false,"internalType":"uint256","name":"amount","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"usdWeight","type":"uint256"}],"name":"BetBabyDoge","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"uint256","name":"roundId","type":"uint256"},{"indexed":true,"internalType":"address","name":"player","type":"address"},{"indexed":false,"internalType":"uint256","name":"amount","type":"uint256"}],"name":"BetFree","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"uint256","name":"roundId","type":"uint256"},{"indexed":true,"internalType":"address","name":"player","type":"address"},{"indexed":false,"internalType":"uint256","name":"amount","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"usdWeight","type":"uint256"}],"name":"BetNative","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"uint256","name":"roundId","type":"uint256"},{"indexed":true,"internalType":"address","name":"player","type":"address"},{"indexed":false,"internalType":"uint256","name":"amount","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"usdWeight","type":"uint256"}],"name":"BetUSDT","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"uint256","name":"winnerId","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"commentId","type":"uint256"},{"indexed":true,"internalType":"address","name":"user","type":"address"},{"indexed":false,"internalType":"string","name":"text","type":"string"}],"name":"CommentAdded","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"uint256","name":"winnerId","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"commentId","type":"uint256"},{"indexed":true,"internalType":"address","name":"user","type":"address"},{"indexed":false,"internalType":"string","name":"newText","type":"string"}],"name":"CommentEdited","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"user","type":"address"}],"name":"FreeSpinNoPrize","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"user","type":"address"},{"indexed":false,"internalType":"uint256","name":"prizeTier","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"amount","type":"uint256"}],"name":"FreeSpinWon","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"user","type":"address"},{"indexed":false,"internalType":"string","name":"nickname","type":"string"}],"name":"NicknameCreated","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"uint256","name":"winnerId","type":"uint256"},{"indexed":true,"internalType":"address","name":"user","type":"address"},{"indexed":false,"internalType":"uint8","name":"stars","type":"uint8"}],"name":"Rated","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"user","type":"address"},{"indexed":false,"internalType":"uint256","name":"ethAmount","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"usdtAmount","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"babyDogeAmount","type":"uint256"}],"name":"ReferralRewardClaimed","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"user","type":"address"},{"indexed":true,"internalType":"address","name":"referrer","type":"address"}],"name":"ReferralSet","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"uint256","name":"roundId","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"startTime","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"endTime","type":"uint256"}],"name":"RoundCreated","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"uint256","name":"roundId","type":"uint256"},{"indexed":true,"internalType":"address","name":"winner","type":"address"},{"indexed":false,"internalType":"uint256","name":"rewardETH","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"rewardUSDT","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"rewardBabyDoge","type":"uint256"}],"name":"RoundFinalized","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"uint256","name":"winnerId","type":"uint256"},{"indexed":true,"internalType":"address","name":"user","type":"address"},{"indexed":false,"internalType":"bool","name":"liked","type":"bool"}],"name":"WinnerLiked","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"uint256","name":"winnerId","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"roundId","type":"uint256"},{"indexed":true,"internalType":"address","name":"winner","type":"address"},{"indexed":false,"internalType":"uint256","name":"rewardETH","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"rewardUSDT","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"rewardBabyDoge","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"timestamp","type":"uint256"}],"name":"WinnerRecorded","type":"event"},{"inputs":[],"name":"MAX_BETS_PER_PLAYER","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"MAX_BET_BABYDOGE","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"MAX_BET_NATIVE","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"MAX_BET_USDT_UNSCALED","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"MAX_PLAYERS","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"MIN_BET_BABYDOGE","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"REF_BP","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"winnerId","type":"uint256"},{"internalType":"string","name":"text","type":"string"}],"name":"addCommentToWinner","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"to","type":"address"},{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"adminWithdrawBabyDoge","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"to","type":"address"},{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"adminWithdrawETH","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"to","type":"address"},{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"adminWithdrawUSDT","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"babyDogeDecimals","outputs":[{"internalType":"uint8","name":"","type":"uint8"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"babyDogeToken","outputs":[{"internalType":"contract IERC20","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"babyDogeUsdPrice","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"claimReferralRewards","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"string","name":"nickname","type":"string"}],"name":"createNickname","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"currentRoundId","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"winnerId","type":"uint256"},{"internalType":"uint256","name":"commentId","type":"uint256"},{"internalType":"string","name":"newText","type":"string"}],"name":"editCommentOnWinner","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"feeBP","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"feeCollector","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"rid","type":"uint256"}],"name":"finalizeRound","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"freeBalances","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"freeBetCost","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"winnerId","type":"uint256"}],"name":"getAllCommentsForWinner","outputs":[{"components":[{"internalType":"address","name":"user","type":"address"},{"internalType":"string","name":"text","type":"string"},{"internalType":"uint256","name":"timestamp","type":"uint256"}],"internalType":"struct FaylottoSpinBattle.Comment[]","name":"","type":"tuple[]"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"winnerId","type":"uint256"}],"name":"getAllLikes","outputs":[{"internalType":"address[]","name":"","type":"address[]"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"winnerId","type":"uint256"}],"name":"getAverageRatingForWinner","outputs":[{"internalType":"uint256","name":"avgTimes1e18","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"winnerId","type":"uint256"}],"name":"getCommentCountForWinner","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"getLatestNativePrice","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"winnerId","type":"uint256"}],"name":"getLikeCount","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"rid","type":"uint256"},{"internalType":"address","name":"player","type":"address"}],"name":"getPlayerDeposits","outputs":[{"internalType":"uint256","name":"ethAmount","type":"uint256"},{"internalType":"uint256","name":"usdtAmount","type":"uint256"},{"internalType":"uint256","name":"babyDogeAmount","type":"uint256"},{"internalType":"uint256","name":"usdWeight","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"winnerId","type":"uint256"}],"name":"getRatingCountForWinner","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"user","type":"address"}],"name":"getReferralCount","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"user","type":"address"}],"name":"getReferralList","outputs":[{"internalType":"address[]","name":"","type":"address[]"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"user","type":"address"}],"name":"getReferralRewards","outputs":[{"internalType":"uint256","name":"ethReward","type":"uint256"},{"internalType":"uint256","name":"usdtReward","type":"uint256"},{"internalType":"uint256","name":"babyDogeReward","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"rid","type":"uint256"}],"name":"getRoundBasic","outputs":[{"internalType":"uint256","name":"id","type":"uint256"},{"internalType":"uint256","name":"startTime","type":"uint256"},{"internalType":"uint256","name":"endTime","type":"uint256"},{"internalType":"bool","name":"finalized","type":"bool"},{"internalType":"address","name":"winner","type":"address"},{"internalType":"uint256","name":"totalETH","type":"uint256"},{"internalType":"uint256","name":"totalUSDT","type":"uint256"},{"internalType":"uint256","name":"totalBabyDoge","type":"uint256"},{"internalType":"uint256","name":"playersCount","type":"uint256"},{"internalType":"uint256","name":"totalWeight","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"rid","type":"uint256"}],"name":"getRoundPlayers","outputs":[{"internalType":"address[]","name":"","type":"address[]"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"count","type":"uint256"}],"name":"getWinners","outputs":[{"components":[{"internalType":"uint256","name":"winnerId","type":"uint256"},{"internalType":"uint256","name":"roundId","type":"uint256"},{"internalType":"address","name":"winner","type":"address"},{"internalType":"uint256","name":"rewardETH","type":"uint256"},{"internalType":"uint256","name":"rewardUSDT","type":"uint256"},{"internalType":"uint256","name":"rewardBabyDoge","type":"uint256"},{"internalType":"uint256","name":"timestamp","type":"uint256"}],"internalType":"struct FaylottoSpinBattle.WinnerInfo[]","name":"","type":"tuple[]"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"isFreeSpinPaused","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"","type":"uint256"}],"name":"likeCount","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"","type":"uint256"},{"internalType":"address","name":"","type":"address"}],"name":"liked","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"","type":"uint256"},{"internalType":"uint256","name":"","type":"uint256"}],"name":"likedBy","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"nativeUsdDecimals","outputs":[{"internalType":"uint8","name":"","type":"uint8"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"nextRoundId","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"string","name":"","type":"string"}],"name":"nicknameOwner","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"nicknames","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"owner","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"pauseFreeSpin","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"placeBetBabyDoge","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"placeBetFree","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"placeBetNative","outputs":[],"stateMutability":"payable","type":"function"},{"inputs":[{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"placeBetUSDT","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"quotaTier1","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"quotaTier2","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"quotaTier3","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"quotaTier4","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"quotaTier5","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"quotaTier6","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"quotaTier7","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"quotaTier8","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"quotaTier9","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"winnerId","type":"uint256"},{"internalType":"uint8","name":"stars","type":"uint8"}],"name":"rateWinner","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"","type":"uint256"}],"name":"ratingCountByWinner","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"","type":"uint256"}],"name":"ratingTotalStars","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"","type":"uint256"},{"internalType":"address","name":"","type":"address"}],"name":"ratings","outputs":[{"internalType":"uint8","name":"","type":"uint8"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"referralRewardsBabyDoge","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"referralRewardsETH","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"referralRewardsUSDT","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"},{"internalType":"uint256","name":"","type":"uint256"}],"name":"referrals","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"referrerOf","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"roundLength","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"token","type":"address"}],"name":"setBabyDoge","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"newPrice","type":"uint256"}],"name":"setBabyDogePrice","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"newFeeBP","type":"uint256"}],"name":"setFeeBP","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"newCollector","type":"address"}],"name":"setFeeCollector","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"cost","type":"uint256"}],"name":"setFreeBetCost","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"string","name":"refNickname","type":"string"}],"name":"setReferralByNickname","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"secs","type":"uint256"}],"name":"setRoundLength","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"token","type":"address"}],"name":"setUSDT","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"spinCounts","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"spinFree","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"winnerId","type":"uint256"}],"name":"toggleLikeWinner","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"unpauseFreeSpin","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"usdtDecimals","outputs":[{"internalType":"uint8","name":"","type":"uint8"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"usdtToken","outputs":[{"internalType":"contract IERC20","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"","type":"uint256"}],"name":"winnerList","outputs":[{"internalType":"uint256","name":"winnerId","type":"uint256"},{"internalType":"uint256","name":"roundId","type":"uint256"},{"internalType":"address","name":"winner","type":"address"},{"internalType":"uint256","name":"rewardETH","type":"uint256"},{"internalType":"uint256","name":"rewardUSDT","type":"uint256"},{"internalType":"uint256","name":"rewardBabyDoge","type":"uint256"},{"internalType":"uint256","name":"timestamp","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"","type":"uint256"}],"name":"winners","outputs":[{"internalType":"uint256","name":"winnerId","type":"uint256"},{"internalType":"uint256","name":"roundId","type":"uint256"},{"internalType":"address","name":"winner","type":"address"},{"internalType":"uint256","name":"rewardETH","type":"uint256"},{"internalType":"uint256","name":"rewardUSDT","type":"uint256"},{"internalType":"uint256","name":"rewardBabyDoge","type":"uint256"},{"internalType":"uint256","name":"timestamp","type":"uint256"}],"stateMutability":"view","type":"function"},{"stateMutability":"payable","type":"receive"}];
    
// === Variabel Global ===
let provider, signer, contract, userAddress;
// PERBAIKAN: Variabel history yang tidak terpakai dihapus
// let userHistory = []; 
// let historyPage = 0;
// let isLoadingHistory = false;
// let allHistoryLoaded = false;
// let historyListContainer;
// let historyLoader;
// const HISTORY_PAGE_SIZE = 20;

// === Elemen DOM Roda & Hasil ===
const btn = document.getElementById("centerBtn");  
const connectBtn = document.getElementById("connectBtn");  
const disconnectBtn = document.getElementById("disconnectBtn");  
const walletAddressDiv = document.getElementById("walletAddress");  
const resultText = document.getElementById("resultText");  
const clickSound = document.getElementById("clickSound");  
const spinSound = document.getElementById("spinSound");  
const winSound = document.getElementById("winSound");  
const svg = document.getElementById("wheel");
const spinCountText = document.getElementById("spinCountText");
// === Elemen DOM Modal ===
const walletModal = document.getElementById("walletModal");
const modalCloseBtn = document.getElementById("modalCloseBtn");
const modalWalletAddress = document.getElementById("modalWalletAddress");
const modalNickname = document.getElementById("modalNickname");
const modalEthBalance = document.getElementById("modalEthBalance");
const modalFreeBalance = document.getElementById("modalFreeBalance");
const modalDisconnectBtn = document.getElementById("modalDisconnectBtn");

// PERBAIKAN: Mengganti nama DUMMY menjadi FREE
const freeBalanceText = document.getElementById("dummyBalanceText"); // ID HTML tetap, variabel JS ganti
// PERBAIKAN: Baris ini salah secara logika (mencoba mengubah text di dalam <img>) dan tidak perlu.
// document.getElementById("dummyBalanceText").previousElementSibling.textContent = "Balance BabyDoge:";


// === Elemen DOM Referral ===
const myNickname = document.getElementById("myNickname");
const myReferrer = document.getElementById("myReferrer");
const nicknameInput = document.getElementById("nicknameInput");
const createNicknameBtn = document.getElementById("createNicknameBtn");
const referralLinkSection = document.getElementById("referralLinkSection");
const referralLinkInput = document.getElementById("referralLinkInput");
const copyReferralBtn = document.getElementById("copyReferralBtn");
const ethRewards = document.getElementById("ethRewards");
const usdtRewards = document.getElementById("usdtRewards");
const babyDogeRewards = document.getElementById("babyDogeRewards");
const referralCount = document.getElementById("referralCount");
const claimRewardsBtn = document.getElementById("claimRewardsBtn");
  
// === 2. PETA HADIAH (Sesuai Kontrak V3 "Free") ===
const prizes = [  
  { name: "10.000.000", icon: "bb.svg", tier: 9 }, // Tier 9
  { name: "2.000.000", icon: "bb.svg", tier: 4 }, // Tier 4
  { name: "5.000.000", icon: "bb.svg", tier: 7 }, // Tier 7
  { name: "500.000", icon: "bb.svg", tier: 2 },   // Tier 2
  { name: "6.000.000", icon: "bb.svg", tier: 8 }, // Tier 8
  { name: "1.000.000", icon: "bb.svg", tier: 3 }, // Tier 3
  { name: "3.000.000", icon: "bb.svg", tier: 5 }, // Tier 5
  { name: "4.000.000", icon: "bb.svg", tier: 6 }, // Tier 6
  { name: "250.000", icon: "bb.svg", tier: 1 }    // Tier 1 (Fallback)
];
  
const colors = [  
  "#FFB703","#FB8500","#219EBC","#8ECAE6","#FF69B4","#90EE90",  
  "#FFD700","#ff9f00","#40E0D0"  
];  
  
const radius = 240, cx = 250, cy = 250, total = prizes.length, slice = 360 / total;  
  
// === Fungsi Render Roda ===
function renderWheel() {
  svg.innerHTML = ''; // Bersihkan roda lama
  for (let i = 0; i < total; i++) {  
    const startAngle = (i * slice - 90) * Math.PI / 180;  
    const endAngle = ((i + 1) * slice - 90) * Math.PI / 180;  
    const x1 = cx + radius * Math.cos(startAngle);  
    const y1 = cy + radius * Math.sin(startAngle);  
    const x2 = cx + radius * Math.cos(endAngle);  
    const y2 = cy + radius * Math.sin(endAngle);
    const path = document.createElementNS("http://www.w3.org/2000/svg", "path");  
    path.setAttribute("d", `M ${cx} ${cy} L ${x1} ${y1} A ${radius} ${radius} 0 0 1 ${x2} ${y2} Z`);  
    path.setAttribute("fill", colors[i]);  
    path.setAttribute("stroke", "#fff");  
    path.setAttribute("stroke-width", "2");  
    svg.appendChild(path);  
    prizes[i].path = path;
    const angle = (i + 0.5) * slice - 90;  
    const img = document.createElementNS("http://www.w3.org/2000/svg", "image");  
    const imgX = cx + radius * 0.55 * Math.cos(angle * Math.PI / 180) - 20;  
    const imgY = cy + radius * 0.55 * Math.sin(angle * Math.PI / 180) - 20;  
    img.setAttributeNS("http://www.w3.org/1999/xlink", "href", prizes[i].icon);  
    img.setAttribute("x", imgX);  
    img.setAttribute("y", imgY);  
    img.setAttribute("width", "40");  
    img.setAttribute("height", "40");  
    svg.appendChild(img);  
    const text = document.createElementNS("http://www.w3.org/2000/svg", "text");  
    const textX = cx + radius * 0.8 * Math.cos(angle * Math.PI / 180);  
    const textY = cy + radius * 0.8 * Math.sin(angle * Math.PI / 180);  
    text.setAttribute("x", textX);  
    text.setAttribute("y", textY);  
    text.setAttribute("fill", "#fff");  
    text.setAttribute("font-size", "15");  
    text.setAttribute("font-weight", "bold");  
    text.setAttribute("text-anchor", "middle");  
    text.setAttribute("alignment-baseline", "middle");  
    text.setAttribute("transform", `rotate(${angle + 90}, ${textX}, ${textY})`);  
    text.textContent = prizes[i].name;  
    svg.appendChild(text);  
  }  
}
  
let spinning = false, currentRotation = 0;  

// === Fungsi Animasi Glow ===
function glowWinnerSector(winnerIndex) {
  if (winnerIndex < 0 || winnerIndex >= prizes.length) return;
  const sector = prizes[winnerIndex].path;
  if (!sector) return;
  sector.style.filter = "drop-shadow(0 0 25px #00ffff) drop-shadow(0 0 50px #00ffff)";
  sector.style.stroke = "#00ffff";
  sector.style.strokeWidth = "3";
  gsap.to(sector, {
    scale: 1.08, rotation: "+=1", transformOrigin: "50% 50%",
    duration: 0.3, repeat: -1, yoyo: true, ease: "sine.inOut"
  });
  setTimeout(() => {
    gsap.killTweensOf(sector);
    sector.style.filter = "";
    sector.style.stroke = "#fff";
    sector.style.strokeWidth = "2";
    gsap.to(sector, { scale: 1, rotation: 0, duration: 0.3 });
  }, 6000);
}

// === 3. FUNGSI SPIN (Logika V3 "Free") ===
async function spinFromBlockchain() {
  if (spinning || !contract) {
    resultText.textContent = "Harap hubungkan wallet dulu.";
    return;
  }
  spinning = true;
  btn.disabled = true;
  btn.textContent = "WAIT...";
  resultText.textContent = "Mengirim transaksi...";
  
  try {
    const tx = await contract.spinFree();
    resultText.textContent = "Menunggu konfirmasi blockchain...";
    const receipt = await tx.wait();
    spinSound.play(); 
    const { prizeTier, prizeAmount } = parseReceiptForPrize(receipt);
    const winnerIndex = getTargetSlice(prizeTier);
    
    if (winnerIndex === -1) throw new Error("Gagal memetakan hadiah.");
    
    const winner = prizes[winnerIndex];

    // --- PERHITUNGAN MATEMATIKA PRESISI (FIX POINTER NGACO) ---
    const sliceAngle = 360 / total;
    
    // 1. Hitung posisi roda saat ini (0-360 derajat)
    const currentPosition = currentRotation % 360;
    
    // 2. Hitung target posisi pemenang (0-360 derajat)
    const targetPosition = (360 - (winnerIndex * sliceAngle) - (sliceAngle / 2));
    
    // 3. Hitung JARAK yang harus ditempuh dari posisi sekarang ke target
    let distance = targetPosition - currentPosition;
    // Jika jarak negatif, tambahkan 360 agar berputar ke depan (searah jarum jam)
    if (distance < 0) {
        distance += 360;
    }
    
    // 4. Tambahkan putaran ekstra (Misal: 10 putaran penuh)
    const extraSpins = 360 * 10; 
    
    // 5. Total rotasi absolut baru
    const finalRotation = currentRotation + distance + extraSpins;
    // -----------------------------------------------------------

    gsap.to(svg, {
      rotation: finalRotation, 
      duration: 35, // Durasi 8 detik (pas untuk 10 putaran)
      ease: "expo.inOut", // Efek 'Ngebut' dramatis di tengah
      onComplete: () => {
        winSound.play();
        resultText.textContent = `üéâ Anda menang: ${winner.name} BabyDoge! üéâ`;
        glowWinnerSector(winnerIndex);
        resetButton();
        
        // Update UI Langsung
        updateUI();
        
        // Update UI LAGI setelah 3 detik (Mengatasi lag node RPC)
        setTimeout(() => {
            console.log("Re-checking balance...");
            updateUI();
        }, 3000);
        
        // Simpan posisi terakhir untuk spin berikutnya
        currentRotation = finalRotation; 
      }
    });

  } catch (err) {
    console.error("Spin Gagal:", err);
    let errorMsg = "Spin Gagal! (Ditolak, kuota habis, atau event dijeda)";
    const errorReason = err.reason || (err.data ? err.data.message : null) || err.message || "";
    if (errorReason.includes("Max 2 free spins")) {
        errorMsg = "Jatah spin Anda sudah habis (2/2).";
    } else if (errorReason.includes("Free promo is paused")) {
        errorMsg = "Event free spin sedang dijeda oleh admin.";
    } else if (errorReason.includes("user rejected transaction")) {
        errorMsg = "Anda menolak transaksi.";
    }
    resultText.textContent = errorMsg;
    resetButton();
    // Tetap update UI jika gagal untuk memastikan status tombol/saldo benar
    updateUI();
  }
}
    

// === 4. FUNGSI HELPER (Logika V3 "Free") ===

// PERBAIKAN: Hanya mencari 'FreeSpinWon'
function parseReceiptForPrize(receipt) {
  if (FAYLOTTO_ABI.length === 0) {
      console.error("ABI WRONG!");
      return { prizeTier: 1, prizeAmount: 0 };
  }
  const iface = new ethers.Interface(FAYLOTTO_ABI);
  
  const wonEvent = iface.getEvent("FreeSpinWon");
  if (!wonEvent) {
      console.error("ABI Error: Event 'FreeSpinWon' tidak ditemukan!");
      return { prizeTier: 1, prizeAmount: 0 }; 
  }
  
  for (const log of receipt.logs) {
    try {
      const parsedLog = iface.parseLog(log);
      if (parsedLog.name === "FreeSpinWon") {
        return {
          prizeTier: Number(parsedLog.args.prizeTier),
          prizeAmount: parsedLog.args.amount
        };
      }
      // 'FreeSpinNoPrize' sudah tidak ada
    } catch (e) { /* Abaikan log lain */ }
  }
  console.error("Logic Error: Tidak ada event spin yang ditemukan.");
  // Default ke Tier 1 (hadiah hiburan)
  return { prizeTier: 1, prizeAmount: 250000 * (10**18) }; 
}

// PERBAIKAN: Memetakan Tier 1-9
function getTargetSlice(prizeTier) {
  const visualTier = prizeTier;

  const matchingSlices = [];
  for (let i = 0; i < prizes.length; i++) {
    if (prizes[i].tier === visualTier) {
      matchingSlices.push(i);
    }
  }
  if (matchingSlices.length > 0) {
    const randomIndex = Math.floor(Math.random() * matchingSlices.length);
    return matchingSlices[randomIndex];
  }
  
  console.error(`Error: Tier ${prizeTier} dari kontrak tidak ada di roda!`);
  return 8; // Fallback ke index Tier 1 (250k)
}

// PERBAIKAN: Memanggil 'freeBalances' dan desimal 18
async function updateUI() {
  if (!contract) return;
  
  spinCountText.textContent = "...";
  freeBalanceText.textContent = "...";
  myNickname.textContent = "...";
  myReferrer.textContent = "...";

  try {
    const [spins, balance] = await Promise.all([
      contract.spinCounts(userAddress),
      contract.freeBalances(userAddress) // <-- PERBAIKAN: 'freeBalances'
    ]);
    
    const spinsUsed = Number(spins);
    spinCountText.textContent = `${spinsUsed} / 2`;
    // PERBAIKAN: Kontrak V3 'spinFree' menggunakan 18 desimal
    freeBalanceText.textContent = ethers.formatUnits(balance, 18); 

    const [nick, referrerAddr, rewards, count, usdtDecimals, babyDogeDecimals] = await Promise.all([
      contract.nicknames(userAddress),
      contract.referrerOf(userAddress),
      contract.getReferralRewards(userAddress),
      contract.getReferralCount(userAddress),
      contract.usdtDecimals(), // Ambil desimal USDT
      contract.babyDogeDecimals() // Ambil desimal BabyDoge
    ]);

    myNickname.textContent = nick || "-";
    myReferrer.textContent = referrerAddr === ethers.ZeroAddress ? "-" : shortAddress(referrerAddr);
    referralCount.textContent = count.toString();

    if (nick) {
      const link = `${window.location.origin}${window.location.pathname}?ref=${nick}`;
      referralLinkInput.value = link;
      referralLinkSection.style.display = "block";
    } else {
      referralLinkSection.style.display = "none";
    }

    ethRewards.textContent = ethers.formatEther(rewards.ethReward);
    usdtRewards.textContent = ethers.formatUnits(rewards.usdtReward, usdtDecimals); 
    babyDogeRewards.textContent = ethers.formatUnits(rewards.babyDogeReward, babyDogeDecimals);
    
    const totalRewards = rewards.ethReward + rewards.usdtReward + rewards.babyDogeReward;
    claimRewardsBtn.disabled = totalRewards === 0n;

    // PERBAIKAN: Memanggil fungsi history yang hilang akan menyebabkan error.
    // if (userHistory.length === 0 && !isLoadingHistory) {
    //   loadInitialHistory();
    // }

  } catch (err) {
    console.error("Error updating UI:", err);
    resultText.textContent = "Gagal memuat data. Coba refresh.";
    spinCountText.textContent = "0 / 2";
    freeBalanceText.textContent = "0";
    myNickname.textContent = "-";
    myReferrer.textContent = "-";
  }
}
  
// === 5. FUNGSI LOGIKA (Jaringan & Wallet) ===

const BASE_SEPOLIA = {
  chainIdHex: '0x14a34', chainIdDec: 84532, chainName: 'Base Sepolia',
  rpcUrls: ['https://sepolia.base.org'],
  nativeCurrency: { name: 'Ether', symbol: 'ETH', decimals: 18 },
  blockExplorerUrls: ['https://sepolia.basescan.org']
};

function shortAddress(addr) { return addr ? addr.slice(0, 6) + "..." + addr.slice(-4) : ""; }
function hasEthereum() { return typeof window !== 'undefined' && !!window.ethereum; }

async function ensureBaseSepolia() {
  if (!hasEthereum()) throw new Error("no_ethereum");
  const chainId = await window.ethereum.request({ method: 'eth_chainId' });
  if (chainId === BASE_SEPOLIA.chainIdHex) return true;
  try {
    await window.ethereum.request({
      method: 'wallet_switchEthereumChain',
      params: [{ chainId: BASE_SEPOLIA.chainIdHex }]
    });
    return true;
  } catch (err) {
    if (err.code === 4902) {
      await window.ethereum.request({
        method: 'wallet_addEthereumChain',
        params: [BASE_SEPOLIA]
      });
      return true;
    } else {
      throw err;
    }
  }
}

// PERBAIKAN: Fungsi connectWallet disesuaikan dengan HTML
async function connectWallet() {
  try {
    if (!hasEthereum()) {
      alert("ü¶ä Silakan instal MetaMask terlebih dahulu.");
      return;
    }
    await ensureBaseSepolia(); 

    provider = new ethers.BrowserProvider(window.ethereum);
    const accounts = await provider.send("eth_requestAccounts", []);
    if (!accounts || accounts.length === 0) {
        throw new Error("Tidak ada akun terhubung.");
    }
    
    signer = await provider.getSigner();
    userAddress = await signer.getAddress();
    
    if (!ethers.isAddress(FAYLOTTO_ADDRESS) || FAYLOTTO_ADDRESS.startsWith("0x...")) {
         alert("Developer Error: Alamat Kontrak tidak valid atau belum diisi.");
         return;
    }
    if (FAYLOTTO_ABI.length === 0) {
        alert("Developer Error: FAYLOTTO_ABI kosong. Harap isi ABI kontrak.");
        return;
    }

    contract = new ethers.Contract(FAYLOTTO_ADDRESS, FAYLOTTO_ABI, signer);

    // === PERUBAHAN LOGIKA ===
    // 1. Ubah tombol "Connect" menjadi tombol "Info Wallet"
    // 1. Ubah tombol "Connect" menjadi tombol "Info Wallet"
     connectBtn.textContent = "Wallet Info";
    // 2. Hapus listener lama (connect) dan tambahkan listener baru (open modal)
    connectBtn.removeEventListener("click", connectWallet);
    connectBtn.addEventListener("click", openWalletModal);
    // === AKHIR PERUBAHAN ===

    await updateUI(); 
    resultText.textContent = "Wallet terhubung! Silakan spin.";

    await handleReferralOnLoad();

    window.ethereum.removeAllListeners('accountsChanged');
    window.ethereum.removeAllListeners('chainChanged');

    window.ethereum.on('accountsChanged', (accounts) => {
      disconnectWallet();
      if (accounts.length > 0) connectWallet(); 
    });
    window.ethereum.on('chainChanged', (chainIdHex) => {
      disconnectWallet();
      if (chainIdHex === BASE_SEPOLIA.chainIdHex) connectWallet();
    });

  } catch (err) {
    console.error("connectWallet error:", err);
    resultText.textContent = "Koneksi wallet gagal.";
    disconnectWallet(); // Pastikan disconnect membersihkan state
  }
}
    
  // PERBAIKAN: Fungsi disconnectWallet disesuaikan dengan HTML
function disconnectWallet() {
  closeWalletModal(); // Tutup modal jika sedang terbuka
  provider = signer = contract = userAddress = null;
  
  // === PERUBAHAN LOGIKA ===
  // 1. Kembalikan tombol "Info Wallet" menjadi "Connect Wallet"
  connectBtn.textContent = "Connect Wallet";
  
  // 2. Hapus listener (open modal) dan kembalikan listener (connect)
  connectBtn.removeEventListener("click", openWalletModal);
  connectBtn.addEventListener("click", connectWallet);
  // === AKHIR PERUBAHAN ===
  
  resultText.textContent = "Press SPIN to play";
  spinCountText.textContent = "0 / 2";
  freeBalanceText.textContent = "0";

  myNickname.textContent = "-";
  myReferrer.textContent = "-";
  referralCount.textContent = "0";
  ethRewards.textContent = "0";
  usdtRewards.textContent = "0";
  babyDogeRewards.textContent = "0";
  referralLinkSection.style.display = "none";
  nicknameInput.value = "";
}
  
function resetButton() {  
  spinning = false;
  btn.disabled = false;  
  btn.textContent = "FREE SPIN";  
  spinSound.pause();
  spinSound.currentTime = 0;
}  

// === Fungsi Referral (Sesuai Kontrak V3) ===

async function handleReferralOnLoad() {
  const params = new URLSearchParams(window.location.search);
  const refNickname = params.get('ref');
  
  if (refNickname && contract && userAddress) {
    const currentReferrer = await contract.referrerOf(userAddress);
    if (currentReferrer !== ethers.ZeroAddress) {
        console.log("Pengguna sudah punya referrer.");
        return; 
    }
    try {
      resultText.textContent = `Mendaftarkan referrer: ${refNickname}...`;
      const tx = await contract.setReferralByNickname(refNickname);
      await tx.wait();
      resultText.textContent = `Referrer ${refNickname} berhasil didaftarkan!`;
      await updateUI(); 
    } catch (err) {
      console.warn("Gagal set referrer:", err.message);
      resultText.textContent = "Gagal mendaftarkan referrer. (Mungkin nickname salah?)";
      setTimeout(() => {
        if (!spinning) resultText.textContent = "Wallet terhubung! Silakan spin.";
      }, 3000);
    }
  }
}

async function handleCreateNickname() {
  if (!contract) return;
  const nick = nicknameInput.value;
  if (nick.length < 3) {
    alert("Nickname harus minimal 3 karakter.");
    return;
  }
  
  createNicknameBtn.disabled = true;
  createNicknameBtn.textContent = "Waiting...";
  try {
    const tx = await contract.createNickname(nick);
    await tx.wait();
    alert("Nickname berhasil dibuat/di-update!");
    await updateUI();
  } catch (err) {
    console.error("Gagal buat nickname:", err);
    alert("Gagal membuat nickname. (Mungkin sudah diambil?)");
  }
  createNicknameBtn.disabled = false;
  createNicknameBtn.textContent = "Update";
}

async function handleClaimRewards() {
  if (!contract) return;
  
  claimRewardsBtn.disabled = true;
  claimRewardsBtn.textContent = "Waiting...";
  try {
    const tx = await contract.claimReferralRewards();
    await tx.wait();
    alert("Rewards berhasil diklaim!");
    await updateUI();
  } catch (err) {
    console.error("Gagal klaim:", err);
    alert("Gagal klaim rewards. (Mungkin tidak ada rewards?)");
  }
  claimRewardsBtn.textContent = "Claim Rewards";
}

function handleCopyLink() {
  referralLinkInput.select();
  try {
    navigator.clipboard.writeText(referralLinkInput.value);
    alert("Link referral disalin!");
  } catch (err) {
    console.error("Gagal menyalin:", err);
    alert("Gagal menyalin link.");
  }
}
  
// === FUNGSI MODAL BARU ===
async function openWalletModal() {
  if (!provider || !contract || !userAddress) return;

  // Set loading state
  modalWalletAddress.textContent = "Memuat...";
  modalNickname.textContent = "Memuat...";
  modalEthBalance.textContent = "Memuat...";
  modalFreeBalance.textContent = "Memuat...";
  walletModal.style.display = "block";

  try {
    // Ambil data terbaru secara bersamaan
    const [ethBalance, nick, freeBalance] = await Promise.all([
      provider.getBalance(userAddress),
      contract.nicknames(userAddress),
      contract.freeBalances(userAddress)
    ]);

    // Isi modal dengan data
    modalWalletAddress.textContent = userAddress;
    modalNickname.textContent = nick || "-0x (No nickname yet)";
    modalEthBalance.textContent = ethers.formatEther(ethBalance);
    modalFreeBalance.textContent = ethers.formatUnits(freeBalance, 18);

  } catch (err) {
    console.error("Gagal memuat info wallet:", err);
    modalWalletAddress.textContent = "Gagal memuat data.";
    // ... (set error untuk field lain)
  }
}

function closeWalletModal() {
  walletModal.style.display = "none";
}
  
// === Event Listeners ===
connectBtn.addEventListener("click", connectWallet);  
// (disconnectBtn sudah tidak ada, diganti modalDisconnectBtn)
btn.addEventListener("click", spinFromBlockchain);
createNicknameBtn.addEventListener("click", handleCreateNickname);
claimRewardsBtn.addEventListener("click", handleClaimRewards);
copyReferralBtn.addEventListener("click", handleCopyLink); 
referralLinkInput.addEventListener("click", handleCopyLink); 

// Panggil renderWheel saat DOM dimuat
document.addEventListener('DOMContentLoaded', renderWheel);
window.addEventListener('resize', renderWheel);

// --- PINDAHKAN KE SINI ---
// Listener Modal
modalCloseBtn.addEventListener("click", closeWalletModal);
modalDisconnectBtn.addEventListener("click", disconnectWallet);

// Tutup modal jika klik di luar area konten
window.addEventListener("click", (event) => {
  if (event.target == walletModal) {
    closeWalletModal();
  }
});
// --- AKHIR PINDAHAN ---

// Listener FAQ (SEKARANG TERPISAH)
document.querySelectorAll(".faq-question").forEach(btn => {
  btn.addEventListener("click", () => {
    const item = btn.parentElement;
    const isActive = item.classList.contains("active");

    // Tutup semua item
    document.querySelectorAll(".faq-item").forEach(el => el.classList.remove("active"));
    
    // (Kode listener modal sudah dipindah keluar dari sini)
    
    // Jika bukan yang aktif sebelumnya, buka yang diklik
    if (!isActive) {
      item.classList.add("active");
      gsap.fromTo(item.querySelector(".faq-answer"), {opacity: 0, y: -10}, {opacity: 1, y: 0, duration: 0.4});
    }
  });
});
</script>

</body>
  </html>
