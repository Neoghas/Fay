<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Spin Wheel DApp</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
  <style>
    body {
      background: radial-gradient(circle at center, #111, #000);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
      color: #fff;
      font-family: sans-serif;
      overflow: hidden;
    }
    .wheel-container {
      position: relative;
      width: 320px;
      height: 320px;
    }
    canvas {
      width: 100%;
      height: 100%;
      border-radius: 50%;
    }
    /* Pointer arah ke tengah bundaran */
    .pointer {
      position: absolute;
      top: 50%;
      left: calc(100% - 5px);
      transform: translateY(-50%) rotate(90deg);
      width: 0;
      height: 0;
      border-top: 12px solid transparent;
      border-bottom: 12px solid transparent;
      border-left: 25px solid red;
      z-index: 10;
      filter: drop-shadow(0 0 4px #f00);
    }
    button {
      margin-top: 40px;
      padding: 14px 32px;
      border: none;
      border-radius: 50%;
      background: yellow;
      color: #000;
      font-weight: bold;
      font-size: 16px;
      cursor: pointer;
      box-shadow: 0 0 25px yellow;
    }
    #result {
      margin-top: 20px;
      font-size: 18px;
      color: gold;
      text-align: center;
    }
  </style>
</head>
<body>
  <div class="wheel-container">
    <canvas id="wheel" width="320" height="320"></canvas>
    <div class="pointer"></div>
  </div>
  <button id="spin">SPIN</button>
  <div id="result"></div>

  <script>
    const canvas = document.getElementById('wheel');
    const ctx = canvas.getContext('2d');
    const btn = document.getElementById('spin');
    const result = document.getElementById('result');

    const prizes = [
      { text: 'MacBook', color: '#ff6f61', img: '💻' },
      { text: 'iPhone', color: '#00bcd4', img: '📱' },
      { text: '0.1 ETH', color: '#ffcc00', img: '🪙' },
      { text: '0.05 ETH', color: '#66cc66', img: '💰' },
      { text: '0.005 ETH', color: '#ff9933', img: '🤑' },
      { text: '1 LPoint', color: '#9966ff', img: '⭐' },
      { text: '2 LPoint', color: '#ff6699', img: '🎯' },
      { text: 'Big Win', color: '#3399ff', img: '🏆' },
    ];

    const sliceAngle = 2 * Math.PI / prizes.length;
    let currentRotation = 0;
    let spinning = false;

    // 🎨 Gambar roda
    function drawWheel(rotation = 0) {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      const radius = canvas.width / 2;

      prizes.forEach((prize, i) => {
        const startAngle = i * sliceAngle + rotation;
        const endAngle = startAngle + sliceAngle;

        // Slice
        ctx.beginPath();
        ctx.moveTo(radius, radius);
        ctx.arc(radius, radius, radius, startAngle, endAngle);
        ctx.fillStyle = prize.color;
        ctx.fill();
        ctx.strokeStyle = '#111';
        ctx.lineWidth = 2;
        ctx.stroke();

        // Text dan gambar
        ctx.save();
        ctx.translate(radius, radius);
        ctx.rotate(startAngle + sliceAngle / 2);
        ctx.textAlign = 'right';
        ctx.fillStyle = '#fff';
        ctx.font = 'bold 14px sans-serif';
        ctx.fillText(prize.text, radius - 15, 5);
        ctx.font = '20px sans-serif';
        ctx.fillText(prize.img, radius - 40, 30);
        ctx.restore();
      });
    }

    drawWheel();

    // 🌀 Spin
    btn.addEventListener('click', () => {
      if (spinning) return;
      spinning = true;

      const randomIndex = Math.floor(Math.random() * prizes.length);
      const targetRotation =
        360 * 6 + (360 - (randomIndex * (360 / prizes.length) + (180 / prizes.length)));

      gsap.to(canvas, {
        rotation: targetRotation,
        duration: 5,
        ease: 'power4.out',
        onUpdate: () => {
          drawWheel((canvas._gsap.rotation * Math.PI) / 180);
        },
        onComplete: () => {
          result.textContent = `🎉 You won: ${prizes[randomIndex].text} ${prizes[randomIndex].img}`;
          spinning = false;
          currentRotation = targetRotation % 360;
          gsap.set(canvas, { rotation: currentRotation });
        },
      });
    });
  </script>
</body>
</html>
