<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Faylotto Spin Wheel</title>
<link href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@700&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/ethers@6.6.4/dist/ethers.umd.min.js"></script>
<style>
  body {
    background: radial-gradient(circle, #111 0%, #000 100%);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    height: 100vh;
    color: #fff;
    font-family: "Ubuntu", sans-serif;
    overflow: hidden;
  }
  
/* Wallet Buttons */
.wallet-controls {
  position: absolute;
  top: 25px;
  right: 25px;
  display: flex;
  flex-direction: row;
  gap: 10px;
}

.wallet-btn {
  background: linear-gradient(145deg, #00b4d8, #0077b6);
  border: none;
  border-radius: 10px;
  color: #fff;
  font-weight: bold;
  padding: 10px 18px;
  cursor: pointer;
  transition: 0.2s;
}

.wallet-btn:hover {
  transform: scale(1.05);
  background: linear-gradient(145deg, #48cae4, #0096c7);
}

/* Box info wallet cyberpunk */
.wallet-info {
  position: absolute;
  top: 70px;
  right: 25px;
  background: linear-gradient(145deg, #00eaff, #a26bff, #ff88ee);
  border-radius: 12px;
  padding: 12px 16px;
  display: flex;
  flex-direction: column;
  gap: 6px;
  min-width: 200px;
  border: 2px solid #0ff;
  box-shadow:
    0 0 10px #00eaff,
    0 0 20px #a26bff,
    0 0 30px #ff88ee;
  color: #fff;
  animation: neonPulse 2s ease-in-out infinite alternate;
}

/* Neon pulsing animation */
@keyframes neonPulse {
  0% {
    box-shadow:
      0 0 10px #00eaff,
      0 0 20px #a26bff,
/* Wallet Buttons */
.wallet-controls {
  position: absolute;
  top: 25px;
  right: 25px;
  display: flex;
  flex-direction: row;
  gap: 10px;
}

.wallet-btn {
  background: linear-gradient(145deg, #00b4d8, #0077b6);
  border: none;
  border-radius: 10px;
  color: #fff;
  font-weight: bold;
  padding: 10px 18px;
  cursor: pointer;
  transition: 0.2s;
}

.wallet-btn:hover {
  transform: scale(1.05);
  background: linear-gradient(145deg, #48cae4, #0096c7);
}

/* Neon wallet info box */
.wallet-info {
  position: absolute;
  top: 70px;
  right: 25px;
  background: #111;
  border-radius: 12px;
  padding: 14px 18px;
  display: flex;
  flex-direction: column;
  gap: 6px;
  min-width: 200px;
  border: 2px solid #0ff;
  box-shadow: 
    0 0 10px #0ff,
    0 0 20px #7b00ff,
    0 0 30px #ff5edc,
    inset 0 0 6px #00eaff;
  animation: neonPulse 2s ease-in-out infinite alternate;
}

/* Neon pulsing animation */
@keyframes neonPulse {
  0% {
    box-shadow: 
      0 0 10px #0ff,
      0 0 20px #7b00ff,
      0 0 30px #ff5edc,
      inset 0 0 6px #00eaff;
  }
  50% {
    box-shadow: 
      0 0 18px #00ffff,
      0 0 36px #bb66ff,
      0 0 60px #ff88ee,
      inset 0 0 12px #00ffff;
  }
  100% {
    box-shadow: 
      0 0 12px #0ff,
      0 0 24px #7b00ff,
      0 0 40px #ff5edc,
      inset 0 0 8px #00eaff;
  }
}

.wallet-address {
  font-size: 14px;
  font-weight: bold;
  color: #0ff;
  text-shadow: 0 0 4px #0ff, 0 0 8px #7b00ff;
}

.wallet-balance {
  font-size: 13px;
  color: #0ff;
  text-shadow: 0 0 3px #0ff, 0 0 6px #ff5edc;
}

  .heel-container {
    position: relative;
    width: 350px;
    height: 350px;
}

  .wheel-container {
  position: relative;
  width: 350px;
  height: 350px;
  display: flex;
  align-items: center;
  justify-content: center;
  overflow: visible;
}

  /* Pastikan animasi yang keluar dari SVG terlihat */
svg {
    width: 100%;
    height: 100%;
    display: block;
    overflow: visible;  /* kunci supaya efek glow tidak terpotong */
}

/* Optional: jika ada group <g> di dalam SVG */
svg g {
    transform-origin: center center;
    overflow: visible;
}

/* Lingkaran listrik menempel di tepi wheel */
.wheel-container::after {
  content: "";
  position: absolute;
  top: 0; left: 0; right: 0; bottom: 0;
  border-radius: 50%;
  border: 7px solid transparent;
  background: conic-gradient(
    from 0deg,
    #00eaff,
    #7b00ff,
    #ff5edc,
    #00eaff
  );
  mask: radial-gradient(farthest-side, transparent calc(100% - 6px), black 100%);
  -webkit-mask: radial-gradient(farthest-side, transparent calc(100% - 3px), black 100%);
  animation: electricFlow 2.5s linear infinite, sparkFlicker 1.2s ease-in-out infinite alternate;
  box-shadow:
    0 0 10px #00eaff,
    0 0 20px #b44bff,
    0 0 30px #ff6be7,
    inset 0 0 12px #00eaff;
  pointer-events: none;
  z-index: 10;
}

/* Efek arus listrik mengalir melingkar */
@keyframes electricFlow {
  0% {
    transform: rotate(0deg);
    filter: hue-rotate(0deg) brightness(1);
  }
  100% {
    transform: rotate(360deg);
    filter: hue-rotate(360deg) brightness(1.3);
  }
}

/* Percikan cepat saat spin */
@keyframes sparkFlickerFast {
  0%, 100% { opacity: 0.95; }
  50% { opacity: 1; }
}

  #enterBtn {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  width: 85px;
  height: 85px;
  border-radius: 50%;
  background: linear-gradient(145deg, #FFD700, #FFA500);
  color: fff;
  font-weight: bold;
  font-size: 16px;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  box-shadow:
    0 0 20px rgba(255, 200, 0, 0.8),
    inset 0 3px 5px rgba(255, 255, 255, 0.4);
  border: 3px solid #fff;
  transition: all 0.3s ease;
  z-index: 15;
  animation: btnGlow 3s infinite alternate;
}

/* Saat hover, cahaya lebih kuat */
#enterBtn:hover {
  transform: translate(-50%, -50%) scale(1.08);
  box-shadow:
    0 0 30px rgba(255, 240, 100, 0.9),
    inset 0 4px 8px rgba(255, 255, 255, 0.6);
}

/* Saat disable */
#enterBtn:disabled {
  opacity: 0.6;
  cursor: not-allowed;
}

/* Animasi glow lembut */
@keyframes btnGlo {
  0% {
    ox-shadow:
      0 0 18px rgba(255, 215, 0, 0.8),
      inset 0 2px 4px rgba(255, 255, 255, 0.3);
  }
  50% {
    ox-shadow:
      0 0 30px rgba(255, 255, 180, 0.9),
      inset 0 3px 6px rgba(255, 255, 255, 0.5);
  }
  100% {
    ox-shadow:
      0 0 18px rgba(255, 215, 0, 0.8),
      inset 0 2px 4px rgba(255, 255, 255, 0.3);
  }
}

#centerBtn {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  width: 85px;
  height: 85px;
  border-radius: 50%;
  background: radial-gradient(circle at 30% 30%, #0ff, #7b00ff, #ff58d6);
  color: #fff;
  font-weight: bold;
  font-size: 16px;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  border: 3px solid transparent;
  box-shadow:
    0 0 25px rgba(0, 255, 255, 0.8),
    0 0 45px rgba(170, 0, 255, 0.6),
    inset 0 0 15px rgba(255, 90, 220, 0.8);
  z-index: 15;
  transition: all 0.3s ease;
  animation: btnGlow 2s ease-in-out infinite alternate;
  overflow: hidden;
}

/* Efek aliran listrik melingkar */
#centerBtn::before {
  content: "";
  position: absolute;
  inset: 0;
  border-radius: 50%;
  border: 3px solid transparent;
  background: conic-gradient(
    from 0deg,
    #00ffff,
    #7b00ff,
    #ff58d6,
    #00ffff
  );
  mask: radial-gradient(farthest-side, transparent calc(100% - 3px), black 100%);
  -webkit-mask: radial-gradient(farthest-side, transparent calc(100% - 3px), black 100%);
  animation: electricRing 1.8s linear infinite;
  pointer-events: none;
  z-index: 1;
}

/* Glow lembut di tombol */
@keyframes btnGlow {
  0% {
    box-shadow:
      0 0 20px #00ffff,
      0 0 40px #7b00ff,
      inset 0 0 15px #ff58d6;
    transform: translate(-50%, -50%) scale(1);
  }
  50% {
    box-shadow:
      0 0 30px #00ffff,
      0 0 60px #b44bff,
      inset 0 0 20px #ff6be7;
    transform: translate(-50%, -50%) scale(1.05);
  }
  100% {
    box-shadow:
      0 0 20px #00ffff,
      0 0 40px #7b00ff,
      inset 0 0 15px #ff58d6;
    transform: translate(-50%, -50%) scale(1);
  }
}

/* Hover â€“ nyala lebih terang */
#centerBtn:hover {
  filter: brightness(1.3);
  box-shadow:
    0 0 35px #00ffff,
    0 0 70px #ff6be7,
    inset 0 0 25px #ff8cff;
}

/* Teks cost ETH di bawah SPIN */
#centerBtn .cost {
  font-size: 10px;
  color: #fff;
  font-weight: bold;
  margin-top: 2px;
  text-shadow: 0 0 5px #00ff6a, 0 0 10px #00ff6a;
}

  .result {
    margin-top: 30px;
    font-size: 20px;
    text-align: center;
    transition: all 0.5s ease;
    min-height: 30px;
  }

  @keyframes pulseGlow {
  0% {
    transform: scale(1);
    filter: drop-shadow(0 0 10px #00ffff)
            drop-shadow(0 0 20px #a26bff)
            drop-shadow(0 0 30px #ff70b8);
  }
  50% {
    transform: scale(1.1);
    filter: drop-shadow(0 0 15px #6bffff)
            drop-shadow(0 0 30px #b57bff)
            drop-shadow(0 0 45px #ff7bd6);
  }
  100% {
    transform: scale(1);
    filter: drop-shadow(0 0 10px #00ffff)
            drop-shadow(0 0 20px #a26bff)
            drop-shadow(0 0 30px #ff70b8);
  }
}

.glow {
  animation: pulseGlow 1s infinite alternate;
  transform-origin: center center;
}
  
</style>
</head>

<body>
  <div class="wallet-controls">
  <button id="connectBtn" class="wallet-btn">Connect Wallet</button>
  <button id="disconnectBtn" class="wallet-btn" style="display:none;">Disconnect</button>
</div>

<div class="wallet-controls">
  <button id="connectBtn" class="wallet-btn">Connect Wallet</button>
  <button id="disconnectBtn" class="wallet-btn" style="display:none;">Disconnect</button>
</div>

<div class="wallet-controls">
  <button id="connectBtn" class="wallet-btn">Connect Wallet</button>
  <button id="disconnectBtn" class="wallet-btn" style="display:none;">Disconnect</button>
</div>

<!-- Box info wallet neon -->
<div id="walletInfo" class="wallet-info" style="display:none;">
  <div id="walletAddress" class="wallet-address">-</div>
  <div id="ethBalance" class="wallet-balance">ETH: -</div>
  <div id="faylottoBalance" class="wallet-balance">Faylotto: -</div>
</div>
  
  <div class="wheel-container">
    <svg id="wheel" viewBox="0 0 500 500"></svg>
    <div id="centerBtn">
  SPIN<br>
  <span class="cost">0.000256 ETH<br><center>Cost</center></span>
    </div>
  </div>
  <div class="result" id="resultText">Press SPIN to play</div>

  <audio id="clickSound" src="click.mp3" preload="auto"></audio>
  <audio id="spinSound" src="spin.mp3" preload="auto" loop></audio>
  <audio id="winSound" src="win.mp3" preload="auto"></audio>

<script>
// === CONTRACT ===
const CONTRACT_ADDRESS = "0x85Ff2021Fee19c1Dcc9f019b4C57F86E2FA280f1";
const ABI = [{"inputs":[],"stateMutability":"nonpayable","type":"constructor"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"owner_","type":"address"},{"indexed":true,"internalType":"address","name":"spender","type":"address"},{"indexed":false,"internalType":"uint256","name":"value","type":"uint256"}],"name":"Approval","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"user","type":"address"},{"indexed":true,"internalType":"uint256","name":"globalBetId","type":"uint256"}],"name":"BetLiked","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"player","type":"address"},{"indexed":false,"internalType":"uint256","name":"amount","type":"uint256"},{"indexed":false,"internalType":"string","name":"result","type":"string"},{"indexed":false,"internalType":"uint256","name":"timestamp","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"randomNumber","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"contractBalance","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"playerBetCount","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"totalBets","type":"uint256"},{"indexed":false,"internalType":"string","name":"highestAvailablePrize","type":"string"},{"indexed":false,"internalType":"bool","name":"prizeAvailable","type":"bool"},{"indexed":false,"internalType":"uint256","name":"winChance","type":"uint256"}],"name":"BetPlaced","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"user","type":"address"},{"indexed":true,"internalType":"uint256","name":"globalBetId","type":"uint256"}],"name":"BetUnliked","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"user","type":"address"},{"indexed":true,"internalType":"uint256","name":"globalBetId","type":"uint256"},{"indexed":false,"internalType":"string","name":"text","type":"string"}],"name":"CommentAdded","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"user","type":"address"},{"indexed":true,"internalType":"uint256","name":"globalBetId","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"commentIndex","type":"uint256"},{"indexed":false,"internalType":"string","name":"newText","type":"string"}],"name":"CommentEdited","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"player","type":"address"},{"indexed":false,"internalType":"uint256","name":"amount","type":"uint256"},{"indexed":false,"internalType":"string","name":"prizeName","type":"string"}],"name":"ETHAwarded","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"to","type":"address"},{"indexed":false,"internalType":"uint256","name":"amount","type":"uint256"}],"name":"FaylottoAwarded","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"to","type":"address"},{"indexed":false,"internalType":"uint256","name":"amount","type":"uint256"}],"name":"FaylottoMinted","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"player","type":"address"},{"indexed":false,"internalType":"uint256","name":"freeSpinNumber","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"rewardAmount","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"timestamp","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"random","type":"uint256"}],"name":"FreeSpinPlayed","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"from","type":"address"},{"indexed":false,"internalType":"uint256","name":"amount","type":"uint256"}],"name":"OwnerDepositFaylotto","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"user","type":"address"},{"indexed":true,"internalType":"uint256","name":"globalBetId","type":"uint256"},{"indexed":false,"internalType":"uint8","name":"rating","type":"uint8"}],"name":"RatingAdded","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"user","type":"address"},{"indexed":true,"internalType":"uint256","name":"globalBetId","type":"uint256"},{"indexed":false,"internalType":"uint8","name":"oldRating","type":"uint8"},{"indexed":false,"internalType":"uint8","name":"newRating","type":"uint8"}],"name":"RatingEdited","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"inviter","type":"address"},{"indexed":true,"internalType":"address","name":"referee","type":"address"}],"name":"ReferralAdded","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"user","type":"address"},{"indexed":false,"internalType":"uint256","name":"amount","type":"uint256"}],"name":"ReferralRewardClaimed","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"inviter","type":"address"},{"indexed":true,"internalType":"address","name":"referee","type":"address"},{"indexed":false,"internalType":"uint256","name":"reward","type":"uint256"}],"name":"ReferralRewardEarned","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"from","type":"address"},{"indexed":true,"internalType":"address","name":"to","type":"address"},{"indexed":false,"internalType":"uint256","name":"value","type":"uint256"}],"name":"Transfer","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"user","type":"address"},{"indexed":false,"internalType":"string","name":"uid","type":"string"}],"name":"UIDGenerated","type":"event"},{"anonymous":false,"inputs":[],"name":"UserTransfersPaused","type":"event"},{"anonymous":false,"inputs":[],"name":"UserTransfersUnpaused","type":"event"},{"stateMutability":"payable","type":"fallback"},{"inputs":[],"name":"INITIAL_SUPPLY","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"MAX_SUPPLY","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"globalBetId","type":"uint256"},{"internalType":"string","name":"text","type":"string"}],"name":"addComment","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"string","name":"refereeUID","type":"string"}],"name":"addReferralByUID","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"owner_","type":"address"},{"internalType":"address","name":"spender","type":"address"}],"name":"allowance","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"spender","type":"address"},{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"approve","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"a","type":"address"}],"name":"balanceOf","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"claimReferralReward","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"claimedReferralRewards","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"dailyQuota","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"dailyUsedQuota","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"decimals","outputs":[{"internalType":"uint8","name":"","type":"uint8"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"globalBetId","type":"uint256"},{"internalType":"uint256","name":"commentIndex","type":"uint256"},{"internalType":"string","name":"newText","type":"string"}],"name":"editComment","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"freeSpin","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"freeSpinData","outputs":[{"internalType":"uint256","name":"freeSpinsUsed","type":"uint256"},{"internalType":"uint256","name":"lastActive","type":"uint256"},{"internalType":"uint256","name":"walletCreated","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"freeSpinQuota","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"generateUID","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"globalBetId","type":"uint256"}],"name":"getAverageRating","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"globalBetId","type":"uint256"}],"name":"getComments","outputs":[{"components":[{"internalType":"address","name":"user","type":"address"},{"internalType":"string","name":"text","type":"string"},{"internalType":"uint256","name":"timestamp","type":"uint256"}],"internalType":"struct FaylottoSpinBet.Comment[]","name":"","type":"tuple[]"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"globalBetId","type":"uint256"}],"name":"getLikeCount","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"getPublicBets","outputs":[{"components":[{"internalType":"address","name":"player","type":"address"},{"internalType":"uint256","name":"amount","type":"uint256"},{"internalType":"string","name":"result","type":"string"},{"internalType":"uint256","name":"timestamp","type":"uint256"},{"internalType":"uint256","name":"randomNumber","type":"uint256"},{"internalType":"uint256","name":"contractBalance","type":"uint256"},{"internalType":"uint256","name":"playerBetCount","type":"uint256"},{"internalType":"uint256","name":"totalBets","type":"uint256"},{"internalType":"string","name":"highestAvailablePrize","type":"string"},{"internalType":"bool","name":"prizeAvailable","type":"bool"},{"internalType":"uint256","name":"winChance","type":"uint256"}],"internalType":"struct FaylottoSpinBet.Bet[]","name":"","type":"tuple[]"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"globalBetId","type":"uint256"}],"name":"getRatingCount","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"user","type":"address"}],"name":"getReferralCount","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"user","type":"address"}],"name":"getReferralList","outputs":[{"internalType":"address[]","name":"","type":"address[]"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"user","type":"address"}],"name":"getReferralReward","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"getUserBets","outputs":[{"components":[{"internalType":"address","name":"player","type":"address"},{"internalType":"uint256","name":"amount","type":"uint256"},{"internalType":"string","name":"result","type":"string"},{"internalType":"uint256","name":"timestamp","type":"uint256"},{"internalType":"uint256","name":"randomNumber","type":"uint256"},{"internalType":"uint256","name":"contractBalance","type":"uint256"},{"internalType":"uint256","name":"playerBetCount","type":"uint256"},{"internalType":"uint256","name":"totalBets","type":"uint256"},{"internalType":"string","name":"highestAvailablePrize","type":"string"},{"internalType":"bool","name":"prizeAvailable","type":"bool"},{"internalType":"uint256","name":"winChance","type":"uint256"}],"internalType":"struct FaylottoSpinBet.Bet[]","name":"","type":"tuple[]"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"globalBetId","type":"uint256"},{"internalType":"address","name":"user","type":"address"}],"name":"getUserLike","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"globalBetId","type":"uint256"},{"internalType":"address","name":"user","type":"address"}],"name":"getUserRating","outputs":[{"internalType":"uint8","name":"","type":"uint8"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"string","name":"prize","type":"string"}],"name":"isPrizeAvailable","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"bytes32","name":"","type":"bytes32"}],"name":"lastPrizeTimestamps","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"lastResetTime","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"globalBetId","type":"uint256"}],"name":"likeSpin","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"minInactiveTime","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"minWalletAge","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"name","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"owner","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"ownerDepositFaylotto","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"pause","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"pauseUserTransfers","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"placeBet","outputs":[],"stateMutability":"payable","type":"function"},{"inputs":[{"internalType":"bytes32","name":"","type":"bytes32"}],"name":"prizeWindowCount","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"bytes32","name":"","type":"bytes32"}],"name":"prizeWindowStart","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"publicHistoryLimit","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"globalBetId","type":"uint256"},{"internalType":"uint8","name":"rating","type":"uint8"}],"name":"rateBet","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"referrals","outputs":[{"internalType":"address","name":"inviter","type":"address"},{"internalType":"uint256","name":"rewardEarned","type":"uint256"},{"internalType":"string","name":"uid","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"spinBetPaid","outputs":[],"stateMutability":"payable","type":"function"},{"inputs":[],"name":"spinPrice","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"symbol","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"totalBetsEver","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"totalSupply","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"to","type":"address"},{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"transfer","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"from","type":"address"},{"internalType":"address","name":"to","type":"address"},{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"transferFrom","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"string","name":"","type":"string"}],"name":"uidToAddress","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"unpause","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"unpauseUserTransfers","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"userTransfersPaused","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"withdraw","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"withdrawFaylottoFromContract","outputs":[],"stateMutability":"nonpayable","type":"function"},{"stateMutability":"payable","type":"receive"}];

let provider, signer, contract, userAddress;
const btn = document.getElementById("centerBtn");
const connectBtn = document.getElementById("connectBtn");
const disconnectBtn = document.getElementById("disconnectBtn");
const walletAddressDiv = document.getElementById("walletAddress");
const resultText = document.getElementById("resultText");
const clickSound = document.getElementById("clickSound");
const spinSound = document.getElementById("spinSound");
const winSound = document.getElementById("winSound");
const svg = document.getElementById("wheel");

const prizes = [
  { name: "1 ETH", icon: "eth.png" },
  { name: "Try Again", icon: "again.png" },
  { name: "MacBook", icon: "macbook.png" },
  { name: "5 Faylotto", icon: "fpoint.png" },
  { name: "0.1 ETH", icon: "eth.png" },
  { name: "0.05 ETH", icon: "eth.png" },
  { name: "0.7 ETH", icon: "eth.png" },
  { name: "2 Faylotto", icon: "fpoint.png" },
  { name: "0.005 ETH", icon: "eth.png" },
  { name: "0.0005 ETH", icon: "eth.png" },
  { name: "No Prize", icon: "no.png" },
  { name: "0.0001 ETH", icon: "eth.png" },  
  { name: "iPhone", icon: "iphone.png" },
  { name: "7 Faylotto", icon: "fpoint.png" }
];

const prizeMap = {
  "1 ETH Jackpot": "1 ETH",
  "0.7 ETH Big Win": "0.7 ETH",
  "Won MacBook!": "MacBook Air",
  "iPhone or Worth ETH": "iPhone Promax",
  "0.1 ETH Monthly Prize": "0.1 ETH",
  "0.05 ETH Monthly Prize": "0.05 ETH",
  "0.005 ETH Weekly": "0.005 ETH",
  "0.0005 ETH Three-day Prize": "0.0005 ETH",
  "0.0001 ETH Daily Prize": "0.0001 ETH",
  "Won 2 Faylotto": "2 Faylotto",
  "Won 5 Faylotto": "5 Faylotto",
  "Won 7 Faylotto": "7 Faylotto",
  "Try Again": "Try Again",
  "No Prize": "No Prize"
};

const colors = [
  "#FB8500",
  "#FF6347",
  "#571aff",
  "#72a2b8",
  "#FF69B4",
  "#65a765",
  "#FFB703",
  "#33b3a6",
  "#79b321",
  "#219EBC",
  "#FF4500",
  "#20B2AA",
  "#6A5ACD",
  "#9370DB"
];

const radius = 240, cx = 250, cy = 250, total = prizes.length, slice = 360 / total;  
  
// Render wheel dengan icon & teks  
for (let i = 0; i < total; i++) {  
  const startAngle = (i * slice - 90) * Math.PI / 180;  
  const endAngle = ((i + 1) * slice - 90) * Math.PI / 180;  
  const x1 = cx + radius * Math.cos(startAngle);  
  const y1 = cy + radius * Math.sin(startAngle);  
  const x2 = cx + radius * Math.cos(endAngle);  
  const y2 = cy + radius * Math.sin(endAngle);  
  
  const path = document.createElementNS("http://www.w3.org/2000/svg", "path");  
  path.setAttribute("d", `M ${cx} ${cy} L ${x1} ${y1} A ${radius} ${radius} 0 0 1 ${x2} ${y2} Z`);  
  path.setAttribute("fill", colors[i]);  
  path.setAttribute("stroke", "#fff");  
  path.setAttribute("stroke-width", "2");  
  svg.appendChild(path);  
  prizes[i].path = path;  
  
  const angle = (i + 0.5) * slice - 90;

  // icon
  const img = document.createElementNS("http://www.w3.org/2000/svg", "image");
  const imgX = cx + radius * 0.55 * Math.cos(angle * Math.PI / 180) - 20;
  const imgY = cy + radius * 0.55 * Math.sin(angle * Math.PI / 180) - 20;
  img.setAttributeNS("http://www.w3.org/1999/xlink", "href", prizes[i].icon);
  img.setAttribute("x", imgX);
  img.setAttribute("y", imgY);
  img.setAttribute("width", "40");
  img.setAttribute("height", "40");
  svg.appendChild(img);

  // teks
  const text = document.createElementNS("http://www.w3.org/2000/svg", "text");
  const textX = cx + radius * 0.8 * Math.cos(angle * Math.PI / 180);
  const textY = cy + radius * 0.8 * Math.sin(angle * Math.PI / 180);
  text.setAttribute("x", textX);
  text.setAttribute("y", textY);
  text.setAttribute("fill", "#fff");
  text.setAttribute("font-size", "15");
  text.setAttribute("font-weight", "bold");
  text.setAttribute("text-anchor", "middle");
  text.setAttribute("alignment-baseline", "middle");
  text.setAttribute("transform", `rotate(${angle}, ${textX}, ${textY})`);
  text.textContent = prizes[i].name;
  svg.appendChild(text);
}

let spinning = false,
  currentRotation = 0,
  animation = null;

  async function connectWallet() {
  if (!window.ethereum) return alert("ðŸ¦Š Install MetaMask!");
  
  provider = new ethers.BrowserProvider(window.ethereum);
  await provider.send("eth_requestAccounts", []);
  signer = await provider.getSigner();
  contract = new ethers.Contract(CONTRACT_ADDRESS, ABI, signer);
  userAddress = await signer.getAddress();

  // tombol
  connectBtn.style.display = "none";
  disconnectBtn.style.display = "inline-block";

  // info wallet
  walletInfo.style.display = "flex";
  walletAddress.textContent = userAddress.slice(0, 40) + "" + userAddress.slice(-2);

  // ambil ETH balance
  const balance = await provider.getBalance(userAddress);
  ethBalance.textContent = "ETH: " + ethers.formatEther(balance);

  // ambil Faylotto balance
  const fBalance = await contract.balanceOf(userAddress);
  faylottoBalance.textContent = "Faylotto: " + fBalance.toString();
}

function disconnectWallet() {
  provider = signer = contract = userAddress = null;
  
  connectBtn.style.display = "inline-block";
  disconnectBtn.style.display = "none";
  
  walletInfo.style.display = "none";
}
  
function animateSpin(resultName) {
  console.log("Received resultName from backend:", resultName);
  const displayName = prizeMap[resultName] || "No Prize";
  console.log("Mapped displayName:", displayName);
  const index = prizes.findIndex(p => p.name === displayName);
  console.log("Calculated index:", index);

  if (index === -1) {
    console.error(`Hadiah tidak ditemukan: ${displayName}`);
    resultText.textContent = "Error: Hadiah tidak valid";
    resetButton();
    return;
  }

  if (animation) gsap.killTweensOf(svg);
  prizes.forEach(p => p.path.classList.remove("glow"));

  const targetSlice = slice * index + slice / 2;
  const totalRotation = currentRotation + 12 * 360 + targetSlice;
  const duration = 30 + Math.random() * 5;

  animation = gsap.fromTo(
    svg,
    { rotation: currentRotation },
    {
      rotation: totalRotation,
      duration: duration,
      ease: "power3.inOut",
      transformOrigin: "center center",
      onUpdate: () => (currentRotation = gsap.getProperty(svg, "rotation")),
      onComplete: () => {
        spinSound.pause();
        winSound.play();
        const prize = prizes[index];
        prize.path.classList.add("glow");
        resultText.innerHTML = `<img src="win.png" 
  style="width:35px;height:35px;vertical-align:middle;margin-right:6px;">
  You won: <span style="color:gold;font-size:24px;">${displayName}</span> <img src="${prize.icon}" style="width:40px;height:40px;">`;
        setTimeout(resetButton, 2000);
      }
    }
  );
}

function resetButton() {
  btn.disabled = false;
  btn.textContent = "SPIN";
  spinSound.pause();
}

const wheelContainer = document.querySelector('.wheel-container');

connectBtn.addEventListener("click", connectWallet);
disconnectBtn.addEventListener("click", disconnectWallet);
btn.addEventListener("click", spinFromBlockchain);   
</script>

</body>
</body>
    </html>
