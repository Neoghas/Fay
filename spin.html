<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Faylotto Spin Wheel</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
<style>
  body {
    background: radial-gradient(circle, #111 0%, #000 100%);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    height: 100vh;
    color: #fff;
    font-family: "Poppins", sans-serif;
    overflow: hidden;
    position: relative;
  }

  .wheel-container {
    position: relative;
    width: 350px;
    height: 350px;
  }

  svg {
    width: 100%;
    height: 100%;
    display: block;
  }

  .pointer {
    position: absolute;
    top: -15px;
    left: 50%;
    transform: translateX(-50%);
    width: 0;
    height: 0;
    border-left: 12px solid transparent;
    border-right: 12px solid transparent;
    border-top: 30px solid #ff0000;
    z-index: 20;
    filter: drop-shadow(0 0 10px #ff0000);
  }

  #centerBtn {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 85px;
    height: 85px;
    border-radius: 50%;
    background: linear-gradient(145deg, #FFD700, #FFA500);
    color: black;
    font-weight: bold;
    font-size: 16px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    box-shadow: 
      0 8px 25px rgba(255, 215, 0, 0.6),
      inset 0 2px 4px rgba(255, 255, 255, 0.3);
    border: 3px solid #fff;
    transition: all 0.2s ease;
    z-index: 15;
  }
  
  #centerBtn:hover:not(:disabled) {
    transform: translate(-50%, -50%) scale(1.05);
    box-shadow: 
      0 12px 35px rgba(255, 215, 0, 0.8),
      inset 0 2px 4px rgba(255, 255, 255, 0.4);
  }
  
  #centerBtn:active:not(:disabled) {
    transform: translate(-50%, -50%) scale(0.95);
  }

  #centerBtn:disabled {
    opacity: 0.6;
    cursor: not-allowed;
    transform: translate(-50%, -50%) scale(0.95);
  }

  .result {
    margin-top: 30px;
    font-size: 20px;
    text-align: center;
    transition: all 0.5s ease;
    min-height: 50px;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
  }

  .result img {
    width: 30px;
    height: 30px;
  }
</style>
</head>
<body>

<div class="wheel-container">
  <div class="pointer"></div>
  <svg id="wheel" viewBox="0 0 500 500"></svg>
  <div id="centerBtn">SPIN</div>
</div>
<div class="result" id="resultText">Press SPIN to play</div>

<script>
const prizes = [
  { name: "1 ETH", icon: "eth.png", month: 0, frequency: "1x_year" }, // Januari
  { name: "0.7 ETH", icon: "eth.png", month: 11, frequency: "1x_11months" }, // Desember
  { name: "MacBook", icon: "macbook.png", month: 10, frequency: "1x_10months" }, // November
  { name: "iPhone", icon: "iphone.png", month: 9, frequency: "1x_10months" }, // Oktober
  { name: "0.1 ETH", icon: "eth.png", frequency: "5x_month", weight: 0.5 },
  { name: "0.05 ETH", icon: "eth.png", frequency: "5x_15days", weight: 1.0 },
  { name: "0.005 ETH", icon: "eth.png", frequency: "10x_7days", weight: 2.0 },
  { name: "0.0005 ETH", icon: "eth.png", frequency: "50x_3days", weight: 3.0 },
  { name: "0.0001 ETH", icon: "eth.png", frequency: "100x_day", weight: 5.0 },
  { name: "2 FPoint", icon: "fpoint.svg", frequency: "unlimited", weight: 10.0 },
  { name: "5 FPoint", icon: "fpoint.svg", frequency: "unlimited", weight: 10.0 },
  { name: "7 FPoint", icon: "fpoint.svg", frequency: "unlimited", weight: 10.0 }
];

const colors = [
  "#FFB703","#FB8500","#219EBC","#8ECAE6","#FF69B4","#90EE90",
  "#FFD700","#40E0D0","#ADFF2F","#FF6347","#9370DB","#20B2AA"
];

const svg = document.getElementById("wheel");
const resultText = document.getElementById("resultText");
const btn = document.getElementById("centerBtn");

const radius = 240;
const cx = 250;
const cy = 250;
const total = prizes.length;
const slice = 360 / total;

// Buat wheel segments
for (let i = 0; i < total; i++) {
  const startAngle = (i * slice - 90) * (Math.PI / 180);
  const endAngle = ((i + 1) * slice - 90) * (Math.PI / 180);
  const x1 = cx + radius * Math.cos(startAngle);
  const y1 = cy + radius * Math.sin(startAngle);
  const x2 = cx + radius * Math.cos(endAngle);
  const y2 = cy + radius * Math.sin(endAngle);
  const pathData = `M ${cx} ${cy} L ${x1} ${y1} A ${radius} ${radius} 0 0 1 ${x2} ${y2} Z`;

  const path = document.createElementNS("http://www.w3.org/2000/svg", "path");
  path.setAttribute("d", pathData);
  path.setAttribute("fill", colors[i % colors.length]);
  path.setAttribute("stroke", "rgba(255,255,255,0.8)");
  path.setAttribute("stroke-width", "2");
  path.setAttribute("stroke-linejoin", "round");
  svg.appendChild(path);

  // Label (teks)
  const angle = (i + 0.5) * slice - 90;
  const textRadius = radius * 0.75;
  const textX = cx + textRadius * Math.cos((angle * Math.PI) / 180);
  const textY = cy + textRadius * Math.sin((angle * Math.PI) / 180);
  
  const text = document.createElementNS("http://www.w3.org/2000/svg", "text");
  text.setAttribute("x", textX);
  text.setAttribute("y", textY);
  text.setAttribute("fill", "#000");
  text.setAttribute("font-size", "10");
  text.setAttribute("font-weight", "bold");
  text.setAttribute("text-anchor", "middle");
  text.setAttribute("alignment-baseline", "middle");
  text.setAttribute("transform", `rotate(${angle}, ${textX}, ${textY})`);
  text.textContent = prizes[i].name;
  svg.appendChild(text);

  // Ikon
  const iconRadius = radius * 0.5;
  const iconX = cx + iconRadius * Math.cos((angle * Math.PI) / 180);
  const iconY = cy + iconRadius * Math.sin((angle * Math.PI) / 180);
  
  const image = document.createElementNS("http://www.w3.org/2000/svg", "image");
  image.setAttribute("href", prizes[i].icon);
  image.setAttribute("x", iconX - 15);
  image.setAttribute("y", iconY - 15);
  image.setAttribute("width", "30");
  image.setAttribute("height", "30");
  image.setAttribute("transform", `rotate(${angle}, ${iconX}, ${iconY})`);
  svg.appendChild(image);
}

// State management
let spinning = false;
let currentRotation = 0;
const COOLDOWN_DURATION = 5000; // 5 detik cooldown

// Reset wheel to 0 rotation
function resetWheel() {
  gsap.killTweensOf(svg);
  gsap.set(svg, { 
    rotation: 0,
    transformOrigin: "center center"
  });
  currentRotation = 0;
}

// Reset button state
function resetButton() {
  btn.textContent = "SPIN";
  btn.disabled = false;
  spinning = false;
}

// Cooldown handler
function startCooldown() {
  let timeLeft = COOLDOWN_DURATION / 1000;
  btn.disabled = true;
  btn.textContent = `Wait ${timeLeft}s...`;

  const countdown = setInterval(() => {
    timeLeft--;
    if (timeLeft > 0) {
      btn.textContent = `Wait ${timeLeft}s...`;
    } else {
      clearInterval(countdown);
      resetButton();
    }
  }, 1000);
}

// Filter hadiah berdasarkan bulan dan frekuensi
function getAvailablePrizes() {
  const currentMonth = new Date().getMonth(); // 0 = Jan, 11 = Des
  const availablePrizes = prizes.filter(prize => {
    if (prize.month !== undefined) {
      // Hadiah dengan bulan spesifik (1 ETH, 0.7 ETH, MacBook, iPhone)
      return prize.month === currentMonth;
    }
    // Hadiah tanpa batasan bulan (ETH kecil dan FPoint)
    return true;
  });
  return availablePrizes;
}

// Weighted random selection untuk hadiah yang tersedia
function getWeightedRandomIndex(availablePrizes) {
  if (availablePrizes.length === 0) return 0; // Fallback
  const totalWeight = availablePrizes.reduce((sum, prize) => sum + (prize.weight || 1), 0);
  let random = Math.random() * totalWeight;
  
  for (let i = 0; i < availablePrizes.length; i++) {
    random -= availablePrizes[i].weight || 1;
    if (random <= 0) {
      // Cari indeks asli di array prizes
      return prizes.findIndex(p => p.name === availablePrizes[i].name);
    }
  }
  return prizes.findIndex(p => p.name === availablePrizes[availablePrizes.length - 1].name);
}

// Calculate winning index from final rotation
function getWinningIndex(rotation) {
  const normalized = (rotation % 360 + 360) % 360;
  const index = Math.floor((360 - normalized) / slice) % total;
  return index;
}

// Spin animation - 30 DETIK
function spinWheel() {
  if (spinning) return;
  
  // Reset wheel SEBELUM spin baru
  resetWheel();
  
  spinning = true;
  btn.disabled = true;
  btn.textContent = "SPINNING...";
  resultText.innerHTML = "ðŸŽ¡ Spinning...";
  resultText.style.color = "#00FFFF";

  // Dapatkan hadiah yang tersedia berdasarkan bulan
  const availablePrizes = getAvailablePrizes();
  
  // Pilih hadiah secara acak dengan bobot
  const randomIndex = getWeightedRandomIndex(availablePrizes);
  const targetSlice = slice * randomIndex;
  const fullRotations = 30; // 30 full rotations
  const totalRotation = fullRotations * 360 + targetSlice;

  // GSAP timeline untuk perfect control
  const tl = gsap.timeline({
    onUpdate: () => {
      currentRotation = gsap.getProperty(svg, "rotation");
    },
    onComplete: () => {
      const winnerIndex = getWinningIndex(currentRotation);
      const prize = prizes[winnerIndex];
      
      resultText.innerHTML = `ðŸŽ‰ You won: <span style="color:gold;font-size:24px;">${prize.name}</span> <img src="${prize.icon}" alt="${prize.name}">`;
      resultText.style.color = "#FFD700";
      
      // Mulai cooldown
      setTimeout(() => {
        resetWheel();
        startCooldown();
      }, 2000); // 2 detik delay sebelum reset & cooldown
    }
  });

  // Spin 30 detik
  tl.to(svg, {
    rotation: totalRotation,
    duration: 30,
    ease: "power2.inOut",
    transformOrigin: "center center"
  });
}

// Event listeners
btn.addEventListener("click", spinWheel);

// Keyboard support
document.addEventListener('keydown', function(e) {
  if (e.code === 'Space' && !spinning && !btn.disabled) {
    e.preventDefault();
    spinWheel();
  }
});

// Initial reset
resetWheel();
</script>
</body>
</html>
